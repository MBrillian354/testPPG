import{r as n,a as z,b as O,u as M,j as e,L as x,M as P,E as T}from"./index-CMqcppKw.js";import{m as u}from"./proxy-CHSHrnCF.js";import{c as w}from"./createLucideIcon-DFyZBoOJ.js";import{A as C}from"./index-D2tCA2Y-.js";import{C as H}from"./chevron-up-5LyhM3MJ.js";import{C as B}from"./chevron-down-DoTwjDRP.js";import{T as _}from"./trash-Dr5w7x_y.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=w("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=w("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),W=()=>{const[o,p]=n.useState({title:"",message:"",onConfirm:null}),[v,h]=n.useState(!1),[i,b]=n.useState(),[l,f]=n.useState([]),{isLoading:r,error:j,sendRequest:c}=z(),d=O().classId,D=M();n.useEffect(()=>{d&&(async()=>{const a=`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/class/${d}`;try{const s=await c(a);b(s)}catch{}})()},[d,c]);const k=t=>{f(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},$=t=>{console.log("edit attendance",t),D(`/attendance/history/class/edit-confirmation/${t}`)},A=(t,a)=>{const s=async()=>{const g=`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/${a}`,I=JSON.stringify({studentName:t});let N;try{N=await c(g,"DELETE",I,{"Content-Type":"application/json"}),p({title:"Berhasil!",message:N.message,onConfirm:null});const y=await c(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/class/${d}`);b(y)}catch(y){p({title:"Gagal!",message:y.message,onConfirm:null})}};p({title:"Konfirmasi Penghapusan",message:`Hapus absen siswa: ${t}?`,onConfirm:s}),h(!0)},E=()=>{f([])},m=i==null?void 0:i.reduce((t,a)=>{const s=new Date(a.forDate).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return t[s]=t[s]||[],t[s].push(a),t},{}),L=m?Object.keys(m).length:0,S=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{h(!1)},className:`${o.onConfirm?"btn-danger-outline":"button-primary mt-0 "} ${r?"opacity-50 cursor-not-allowed":""}`,disabled:r,children:r?e.jsx(x,{}):o.onConfirm?"Batal":"Tutup"}),o.onConfirm&&e.jsx("button",{onClick:o.onConfirm,className:`button-primary mt-0 ${r?"opacity-50 cursor-not-allowed":""}`,children:r?e.jsx(x,{}):"Ya"})]});return e.jsxs("div",{className:"p-4 space-y-4",children:[r&&!i&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(x,{size:32})}),e.jsxs(P,{isOpen:v,onClose:()=>h(!1),title:o.title,footer:e.jsx(S,{}),children:[r&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(x,{size:32})}),!r&&o.message]}),j&&e.jsx(T,{error:j,onClear:()=>setError(null)}),l.length>1&&L>1&&e.jsxs(u.button,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex items-center gap-2 px-4 py-2 border border-gray-300 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-medium transition-colors",onClick:E,children:[e.jsx(X,{size:16}),"Collapse All"]}),e.jsx(C,{children:m&&Object.entries(m).map(([t,a])=>e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"border shadow-sm rounded-full",children:[e.jsxs(u.button,{onClick:()=>k(t),className:`w-full px-3 py-2 flex justify-between items-center bg-blue-100 hover:bg-blue-200 transition-colors ${l.includes(t)?"rounded-t-md":"rounded-full"}`,children:[e.jsx("span",{className:"font-medium",children:t}),e.jsx("div",{className:"flex items-center gap-2",children:l.includes(t)?e.jsx(H,{size:16}):e.jsx(B,{size:16})})]}),e.jsx(C,{children:l.includes(t)&&e.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden bg-white",children:e.jsxs("table",{className:"w-full table-auto border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{className:"border-t border-gray-300 p-2 text-left text-xs text-gray-500",children:"Nama"}),e.jsx("th",{className:"border-t border-gray-300 p-2 text-left text-xs text-gray-500",children:"Status"}),e.jsx("th",{className:"border-t border-gray-300 p-2 text-left text-xs text-gray-500",children:"Waktu"}),e.jsx("th",{className:"border-t border-gray-300 p-2 text-left text-xs text-gray-500",children:"Pelanggaran"}),e.jsx("th",{className:"border-t border-gray-300 text-left text-xs text-gray-500"})]})}),e.jsx("tbody",{children:a.map(s=>e.jsxs("tr",{className:"bg-white hover:bg-gray-100",children:[e.jsx("td",{className:"border-t border-gray-300 p-2 text-xs",children:s.studentId.name}),e.jsx("td",{className:"border-t border-gray-300 p-2 text-xs",children:s.status}),e.jsx("td",{className:"border-t border-gray-300 p-2 text-xs",children:new Date(s.timestamp).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),e.jsx("td",{className:"border-t border-gray-300 p-2 text-xs",children:Object.values(s==null?void 0:s.violations).filter(g=>g===!0).length||"0"}),new Date().toLocaleDateString("en-CA")!==new Date(s.forDate).toLocaleDateString("en-CA")&&e.jsxs("td",{className:"border-t border-gray-300 text-xs flex",children:[e.jsx("button",{onClick:()=>$(s._id),className:"p-1 rounded-full active:bg-gray-200 text-blue-500 active:text-blue-700 transition duration-300",children:e.jsx(R,{size:16})}),e.jsx("button",{onClick:()=>A(s.studentId.name,s._id),className:"p-1 rounded-full active:bg-gray-200 text-red-500 active:text-red-700 transition duration-300",children:e.jsx(_,{size:16})})]})]},s._id))})]})})})]},t))})]})};export{W as default};
