import{r as c,a as $,u as L,j as e,c as T,E as P,M as _,L as u}from"./index-CP-NX24X.js";import{F as B}from"./FloatingMenu-xran9IDh.js";import{P as M}from"./plus-Bt27oCaq.js";import{P as H}from"./pencil-DdQ9hYEs.js";import{T as S}from"./trash-CNaClfa-.js";import"./createLucideIcon-BEmubaHH.js";const R=()=>{const[n,d]=c.useState({title:"",message:"",onConfirm:null}),[y,o]=c.useState(!1),[h,g]=c.useState(),[N,b]=c.useState({}),{isLoading:a,error:f,sendRequest:l,setError:C}=$(),j=L();c.useEffect(()=>{(async()=>{try{console.log("Fetching Levels...");const s=await l("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/?populate=true");g(s),console.log(s),console.log("Fetching Levels completed")}catch{}})()},[l,n]);const k=t=>{b(s=>({...s,[t]:!s[t]}))},w=(t,s)=>{console.log(s);const i=async()=>{o(!1);const m="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/";console.log(m);const p=JSON.stringify({branchId:s});let x;try{x=await l(m,"DELETE",p,{"Content-Type":"application/json"}),o(!0),d({title:"Berhasil!",message:x.message,onConfirm:null});const r=await l("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/?populate=true");g(r)}catch{}};d({title:"Konfirmasi Penghapusan",message:`Hapus Desa: ${t}?`,onConfirm:i}),o(!0)},D=(t,s,i)=>{t.stopPropagation(),console.log(i);const m=async()=>{o(!1);const p="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/teaching-groupes";console.log(p);const x=JSON.stringify({teachingGroupId:i});let r;try{r=await l(p,"DELETE",x,{"Content-Type":"application/json"}),o(!0),d({title:"Berhasil!",message:r.message,onConfirm:null});const v=await l("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/?populate=true");g(v)}catch{}};d({title:"Konfirmasi Penghapusan",message:`Hapus Desa: ${s}?`,onConfirm:m}),o(!0)},E=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{o(!1)},className:`${n.onConfirm?"btn-danger-outline":"button-primary mt-0 "} ${a?"opacity-50 cursor-not-allowed":""}`,disabled:a,children:a?e.jsx(u,{}):n.onConfirm?"Batal":"Tutup"}),n.onConfirm&&e.jsx("button",{onClick:n.onConfirm,className:`button-primary mt-0 ${a?"opacity-50 cursor-not-allowed":""}`,children:a?e.jsx(u,{}):"Ya"})]});return e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Manajemen Desa dan Kelompok"}),e.jsx(T,{to:"/settings/levels/new",children:e.jsxs("button",{className:"button-primary pl-[10px]",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Tambah"]})})]}),f&&e.jsx(P,{error:f,onClear:()=>C(null)}),e.jsxs(_,{isOpen:y,onClose:()=>o(!1),title:n.title,footer:e.jsx(E,{}),children:[a&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(u,{size:32})}),!a&&n.message]}),!h&&a&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(u,{size:32})}),h&&!a&&e.jsx("div",{className:"bg-white rounded-lg shadow divide-y",children:h.branches.map(t=>e.jsxs("div",{className:"p-4 hover:bg-gray-100 hover:cursor-pointer transition-all duration-200",children:[e.jsxs("div",{onClick:()=>k(t._id),className:"flex items-center space-x-4 ",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-900",children:["Desa ",t.name]}),e.jsxs("div",{className:"text-xs text-gray-500 border border-gray-500 rounded p-1",children:[t.teachingGroups.length," Kelompok"]})]}),e.jsx("div",{className:"flex items-center text-xs text-gray-500 mt-1",children:t.address})]}),e.jsx(B,{onClick:s=>s.stopPropagation(),buttons:[{icon:H,label:"Edit",onClick:()=>j(`/settings/levels/${t._id}`)},{icon:S,label:"Delete",variant:"danger",onClick:()=>w(t.name,t._id)}]})]}),N[t._id]&&e.jsx("div",{className:"mt-3 ml-12 space-y-2",children:t.teachingGroups.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-50 rounded text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["Kelompok ",s.name]}),e.jsx("div",{className:"flex items-center text-xs text-gray-500 mt-1",children:s.address})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>j(`/settings/levels/teaching-group/${s._id}`),className:"px-2 italic text-gray-500 hover:underline hover:text-blue-500 hover:cursor-pointer",children:"Edit"}),e.jsx("button",{onClick:i=>D(i,s.name,s._id),className:"px-2 italic text-gray-500 hover:underline hover:text-red-500 hover:cursor-pointer",children:"Hapus"})]})]},s._id))})]},t._id))})]})})};export{R as default};
