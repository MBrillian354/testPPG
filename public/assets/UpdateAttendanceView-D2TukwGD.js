import{r,a as S,u as N,j as t,L as p}from"./index-CUVeWTx6.js";import{u as T}from"./http-hook-BiPXVO_k.js";import{D as I}from"./DynamicForm-Biq1uxbt.js";import{E as k}from"./ErrorCard-IpMuaMVp.js";import{M as E}from"./ModalBottomClose-We_XnTjp.js";import"./iconify-icon-C1YYA-Pd.js";const K=()=>{var m;const[n,b]=r.useState({title:"",message:"",onConfirm:null}),[f,o]=r.useState(!1),{isLoading:a,error:u,sendRequest:i,setError:x}=T(),[y,O]=r.useState(!1),[e,g]=r.useState(),h=S().attendanceId,v=N();r.useEffect(()=>{(async()=>{try{const s=await i(`http://192.168.1.13:5000/api/attendances/${h}`);g(s.attendance),console.log(s.attendance)}catch{}})()},[i]);const j=async l=>{console.log("Updating ... ");const s="http://192.168.1.13:5000/api/attendances/",c=JSON.stringify({updates:[{attendanceId:e.id,status:l.status,attributes:l.attributes,timestamp:Date.now()}]});console.log(c);let d;try{d=await i(s,"PATCH",c,{"Content-Type":"application/json"})}catch{}b({title:"Berhasil!",message:d.message,onConfirm:()=>v(-2)}),o(!0)},C=()=>t.jsx("div",{className:"flex gap-2 items-center",children:n.onConfirm&&t.jsx("button",{onClick:n.onConfirm,className:"button-primary mt-0 ",children:"Ok"})});return t.jsxs("div",{className:"m-auto max-w-md mt-14 md:mt-8",children:[t.jsxs(E,{isOpen:f,onClose:()=>o(!1),title:n.title,footer:t.jsx(C,{}),children:[a&&t.jsx("div",{className:"flex justify-center mt-16",children:t.jsx(p,{size:32})}),!a&&n.message]}),u&&t.jsx(k,{error:u,onClear:()=>x(null)}),t.jsx("div",{className:`pb-24 transition-opacity duration-300 ${y?"opacity-0":"opacity-100"}`,children:t.jsx(I,{subtitle:"Edit Data Absen",fields:[{name:"name",label:"Nama Lengkap",type:"text",required:!1,disabled:!0,value:((m=e==null?void 0:e.studentId)==null?void 0:m.name)||""},{name:"statusOld",label:"Status Kehadiran (sebelumnya)",type:"text",required:!1,disabled:!0,value:(e==null?void 0:e.status)||""},{name:"attributesOld",label:"Atribut (sebelumnya)",type:"text",required:!1,disabled:!0,value:e!=null&&e.attributes?"Ya":"Tidak"},{name:"status",label:"Status Kehadiran (baru)",type:"select",required:!0,value:(e==null?void 0:e.status)||"",options:[{label:"Hadir",value:"Hadir"},{label:"Terlambat",value:"Terlambat"},{label:"Izin",value:"Izin"},{label:"Sakit",value:"Sakit"},{label:"Tanpa Keterangan",value:"Tanpa Keterangan"}]},{name:"attributes",label:"Atribut Lengkap? (baru)",type:"select",required:!0,value:(e==null?void 0:e.attributes)||"",options:[{label:"Ya",value:"true"},{label:"Tidak",value:"false"}]}],onSubmit:j,disabled:a,reset:!1,footer:!1,button:t.jsx("div",{className:"flex flex-col justify-stretch mt-4",children:t.jsx("button",{type:"submit",className:`button-primary ${a?"opacity-50 cursor-not-allowed":""}`,disabled:a,children:a?t.jsx(p,{children:"Processing..."}):"Update"})})})})]})};export{K as default};
