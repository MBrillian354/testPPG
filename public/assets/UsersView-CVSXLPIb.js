import{r as i,a as I,u as T,A as _,j as e,E as L,M,L as y,c as N}from"./index-b338pBx7.js";import{F as O}from"./FloatingMenu-Dve7mhkT.js";import{T as C}from"./trash-BuqKRXT_.js";import{P as z}from"./plus-Dv9C_VSi.js";import{U as F}from"./users-B-j77gAx.js";import{C as H}from"./chevron-down-B15M6KNz.js";import{P as V}from"./pencil-C40nAcmr.js";import"./createLucideIcon-CrQEAXE0.js";const Z=()=>{const[h,u]=i.useState();i.useState("");const[r,o]=i.useState({title:"",message:"",onConfirm:null}),[k,c]=i.useState(!1),[d,p]=i.useState([]),[g,v]=i.useState({admin:!0,teachingGroupAdmin:!0,teacher:!0,student:!0}),w=["admin","teachingGroupAdmin","teacher","student"],{isLoading:x,error:f,sendRequest:m,setError:D}=I(),A=T(),j=i.useContext(_);i.useEffect(()=>{(async()=>{try{const t=await m("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/users/");u(t)}catch{}})()},[m]);const E=s=>{v(t=>({...t,[s]:!t[s]}))},b=s=>({admin:"bg-red-100 text-red-700",teachingGroupAdmin:"bg-orange-100 text-orange-700",teacher:"bg-violet-100 text-violet-700",student:"bg-blue-100 text-blue-700"})[s]||"bg-gray-100 text-gray-700",S=s=>s==null?void 0:s.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),G=s=>{o({title:"Peringatan!",message:"Hapus Pengguna?",onConfirm:async()=>{try{const n=await m(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/users/${s}`,"DELETE",null,{Authorization:"Bearer "+j.token});o({title:"Berhasil!",message:n.message,onConfirm:null}),u(a=>({...a,users:a.users.filter(l=>l._id!==s)}))}catch{}}}),c(!0)},U=()=>{if(d.length===0){o({title:"Error",message:"Please select at least one user.",onConfirm:null}),c(!0);return}o({title:"Konfirmasi",message:"Hapus semua user yang dipilih?",onConfirm:async()=>{const t="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/users/bulk-delete",n=JSON.stringify({userIds:d});console.log(n);try{const a=await m(t,"DELETE",n,{"Content-Type":"application/json",Authorization:"Bearer "+j.token});o({title:"Berhasil!",message:a.message,onConfirm:null}),u(l=>({...l,users:l.users.filter(B=>!d.includes(B._id))})),p([])}catch{}}}),c(!0)},$=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{c(!1)},className:`${r.onConfirm?"btn-danger-outline":"button-primary mt-0 "}`,children:r.onConfirm?"Batal":"Tutup"}),r.onConfirm&&e.jsx("button",{onClick:r.onConfirm,className:"button-primary mt-0 ",children:"Ya"})]}),P=({user:s})=>{const t=d.includes(s._id),n=()=>{p(a=>t?a.filter(l=>l!==s._id):[...a,s._id])};return e.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:n,className:"mr-2"}),s.image?e.jsx("img",{src:`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/${s.image}`,alt:s.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:`w-10 h-10 rounded-full flex ${b(s.role)} items-center justify-center font-medium`,children:S(s.name)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`hidden md:inline-block px-2.5 py-0.5 rounded-full text-xs font-medium h-6 ${b(s.role)}`,children:s.role==="teachingGroupAdmin"?"Admin Kelompok":s.role==="teacher"?"Guru":s.role==="student"?"Siswa":"Admin DPD"})]}),e.jsx("p",{className:"text-sm text-gray-500 hidden md:block",children:s.role!=="student"&&s.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-900 hidden md:block",children:s.teachingGroupId.branchId.name}),e.jsx("div",{className:"text-xs text-gray-500 hidden md:block",children:s.teachingGroupId.name})]}),e.jsx("div",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(O,{buttons:[{icon:V,label:"Edit",onClick:()=>A(`/settings/users/${s._id}`)},{icon:C,label:"Delete",variant:"danger",onClick:()=>G(s._id)}]})})]})]})};return e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[f&&e.jsx(L,{error:f,onClear:()=>D(null)}),e.jsxs(M,{isOpen:k,onClose:()=>c(!1),title:r.title,footer:e.jsx($,{}),children:[x&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(y,{size:32})}),!x&&r.message]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Daftar User"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,className:"button-danger disabled:hidden",disabled:d.length===0,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Hapus Akun"]}),e.jsx(N,{to:"/settings/users/new",children:e.jsxs("button",{className:"button-primary pl-[14px]",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Tambah Akun"]})}),e.jsx(N,{to:"/settings/users/bulk-create",children:e.jsxs("button",{className:"button-primary pl-[14px]",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Tambah Peserta Didik"]})})]})]}),x&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(y,{size:32})}),h&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white rounded-md shadow-sm",children:w.map(s=>{const t=h.users.filter(n=>n.role===s);return e.jsxs("div",{className:"divide-y",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 cursor-pointer flex items-center justify-between",onClick:()=>E(s),children:[e.jsx("span",{children:s==="teachingGroupAdmin"?"Admin Kelompok":s==="teacher"?"Guru":s==="student"?"Siswa":"Admin"}),e.jsx(H,{className:`w-4 h-4 transform transition-transform ${g[s]?"":"-rotate-90"}`})]}),g[s]&&t.map(n=>e.jsx(P,{user:n},n._id))]},s)})})})]})})};export{Z as default};
