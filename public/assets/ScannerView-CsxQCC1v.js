import{c as H,r as n,w as T,j as e,b as F,u as K,A as G,d as O,L as P,I as R}from"./index-BclD7Oek.js";import{b as _,e as $}from"./store-scanner-beep-90395-BLyWB5Pa.js";import{S as C}from"./SequentialAnimation-ByWnaIEQ.js";import{I as L}from"./iconify-RRlTYOA0.js";import{S as M}from"./StudentInitial-BUOKJrkB.js";import{C as A}from"./chevron-up-VIsgdAuJ.js";import{C as D}from"./chevron-down-Ga8kj93b.js";import{A as z}from"./index-B04DRbXT.js";import{m as E}from"./proxy-Y6K7WLgr.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=H("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=H("SquareCheck",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),V=()=>{const a=n.useRef(null),r=n.useRef(null),[p,d]=n.useState(!1),[c,i]=n.useState(null),[u,f]=n.useState(!1),{state:m,dispatch:S}=n.useContext(T),[k,h]=n.useState(0);n.useEffect(()=>{let l;return(async()=>{if(a.current){l=new $(a.current,async o=>{u||await j(o.data)},{returnDetailedScanResult:!0});try{await l.start(),d(!0)}catch(o){console.error("Camera access denied or unavailable:",o)}}else console.error("Video element not found")})(),()=>{l==null||l.destroy(),d(!1)}},[u]),n.useEffect(()=>{h(u?100:0)},[u]);const x=l=>{const y=new Date,o=y.getHours(),I=y.getMinutes(),[t,s]=l.split(":").map(Number);return o>t||o===t&&I>s?"Terlambat":(o<t||o===t&&I<s,"Hadir")},b=l=>{S({type:"SET_STATUS",payload:l})};let g;const j=async l=>{f(!0);const y=m.studentList.some(o=>o.studentId.nis===l);i(y?{nis:l,status:x(m.classStartTime),name:m.studentList.find(o=>o.studentId.nis===l).studentId.name}:"Kode QR tidak dikenali!"),r.current&&r.current.play(),g={id:l,newStatus:x(m.classStartTime),timestamp:Date.now()},b(g),console.log(g),r.current&&await new Promise(o=>{r.current.onended=o}),setTimeout(()=>{f(!1)},1e3)};return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full p-4",children:[e.jsxs("div",{className:"relative w-72 h-72 border-2 border-gray-700 shadow-md rounded-md overflow-hidden",children:[u===!0?e.jsx("div",{className:" absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx(C,{variant:typeof c=="string"?6:2,children:c&&e.jsx("div",{className:"flex-col text-center",children:typeof c=="string"?e.jsx("p",{className:"text-red-500 font-semibold text-base",children:c}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700 text-lg",children:c.name}),e.jsx("p",{className:"text-gray-700 text-lg",children:c.nis}),e.jsx("p",{className:"text-green-500 font-bold text-2xl",children:c.status})]})})})}):e.jsx("video",{ref:a,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0}),e.jsxs("div",{className:"absolute inset-[8.25%] w-5/6 h-5/6 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-white"}),e.jsx("div",{className:"absolute top-0 right-0 w-12 h-12 border-t-4 border-r-4 border-white"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-12 h-12 border-b-4 border-l-4 border-white"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-white"})]})]}),e.jsx("audio",{ref:r,src:_,preload:"auto"})]})},B=()=>{const[a,r]=n.useState(new Date);n.useEffect(()=>{const i=setInterval(()=>{r(new Date)},1e3);return()=>{clearInterval(i)}},[]);const p=i=>i.toLocaleDateString("id-ID",{day:"2-digit",timeZone:"Asia/Jakarta"}),d=i=>i.toLocaleDateString("id-ID",{month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),c=i=>i.toLocaleTimeString("id-ID",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Jakarta"});return e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold text-2xl mr-3",children:p(a)}),e.jsxs("span",{className:"mr-2",children:[d(a),","]}),e.jsxs("span",{className:"",children:[c(a)," WIB"]})]})},J=()=>{const{state:a,dispatch:r}=n.useContext(T);return e.jsxs("div",{className:"border-2 border-primary rounded-full p-2 text-medium text-primary",children:[a.studentList.filter(p=>p.status==="Hadir").length,"/",a.studentList.length]})},U=()=>e.jsxs("div",{className:"card-basic mx-4 mb-0 justify-between items-center",children:[e.jsx(B,{}),e.jsx(J,{})]}),q=()=>{const{state:a,dispatch:r}=n.useContext(T),p=n.useRef(a.studentList),{isLoading:d,error:c,sendRequest:i}=F(),[u,f]=n.useState({}),[m,S]=n.useState({}),k=async t=>{try{const s="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/",N=JSON.stringify({updates:t});console.log(N);const v=await i(s,"PATCH",N,{"Content-Type":"application/json"});console.log("Successfully updated statuses:",v)}catch(s){console.error("Error updating statuses:",s)}};n.useEffect(()=>{const t=[];a.studentList.forEach((s,N)=>{const v=p.current[N];v&&(v.status!==s.status||v.attributes!==s.attributes||v.violations!==s.violations||v.teachersNotes!==s.teachersNotes)&&t.push({attendanceId:s._id,status:s.status,attributes:s.attributes,violations:s.violations,teachersNotes:s.teachersNotes,timestamp:s.timestamp})}),t.length>0&&k(t),p.current=a.studentList},[a.studentList]);const h=(t,s,N=Date.now())=>{r({type:"SET_STATUS",payload:{id:t,newStatus:s,timestamp:N}})},x=(t,s)=>{r({type:"SET_VIOLATIONS",payload:{id:t,violationType:s}})},b=(t,s)=>{r({type:"SET_NOTES",payload:{id:t,notes:s}})},g=t=>{r({type:"TOGGLE_SELECTED",payload:{id:t}})},j=()=>{r({type:"TOGGLE_SELECT_ALL"})},l=(t,s=Date.now())=>{r({type:"APPLY_BULK_STATUS",payload:{newStatus:t,timestamp:s}})},y=t=>{switch(t){case"Hadir":return"bg-blue-500/50";case"Terlambat":return"bg-yellow-500/50";case"Sakit":return"bg-violet-500/50";case"Izin":return"bg-orange-500/50";default:return"bg-red-500/50"}},o=t=>{f(s=>({...s,[t]:!s[t]}))},I=t=>{S(s=>({...s,[t]:!s[t]}))};return e.jsxs("div",{className:"card-basic mx-4 flex-col box-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-lg font-medium",children:"Daftar Hadir"}),a.studentList.length!==0&&(d?e.jsxs("div",{className:"flex items-center gap-2 animate-pulse",children:[e.jsx(Y,{size:24,className:"animate-spin"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Menyimpan otomatis..."})]}):c?e.jsx(L,{icon:"mdi:cloud-alert-outline",width:"24",height:"24"}):e.jsxs("div",{className:"flex items-center gap-2 animate-pulse",children:[e.jsx(L,{icon:"ci:cloud-check",width:"24",height:"24"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Perubahan tersimpan"})]}))]}),a.studentList.length!==0&&a.isTeachingGroupYearActivated===!0?e.jsxs("div",{className:"inline-flex items-center",children:[e.jsxs("label",{className:"flex items-center cursor-pointer relative",htmlFor:"check-2",children:[e.jsx("input",{type:"checkbox",checked:a.selectAll,onChange:j,className:"peer h-4 w-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-primary checked:border-primary",id:"check-2"}),e.jsx("span",{className:"absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx(w,{})})]}),e.jsx("label",{className:"cursor-pointer ml-2 my-2 text-sm",htmlFor:"check-2",children:"Pilih Semua"})]}):e.jsx("div",{className:"italic text-gray-500 mt-2",children:"Daftar hadir kosong"}),e.jsx("div",{className:`flex flex-col ${a.studentList.length!==0&&a.isTeachingGroupYearActivated===!0?"mb-4":""} `,children:a.isTeachingGroupYearActivated===!0&&a.studentList.map(t=>e.jsxs("div",{className:`p-4 pr-0 mx-[-1rem] min-h-20 flex items-center gap-4 border-b ${y(t.status)} transition-all duration-500`,children:[e.jsxs("label",{className:"flex items-center cursor-pointer relative",htmlFor:t.studentId.nis,children:[e.jsx("input",{type:"checkbox",checked:!!t.isSelected,onChange:()=>g(t.studentId.nis),className:"peer h-4 w-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-primary checked:border-primary",id:t.studentId.nis,disabled:t.status==="Hadir"||t.status==="Terlambat"}),e.jsx("span",{className:"absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx(w,{})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[t.studentId.image?e.jsx("img",{src:`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/${t.studentId.image}`,alt:"Profile",className:"rounded-full size-10 shrink-0"}):e.jsx(M,{studentName:t.studentId.name,clsName:"size-10 rounded-full bg-blue-200 text-blue-500 flex items-center justify-center font-medium"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"uppercase",children:t.studentId.name}),e.jsx("div",{className:"text-xs text-gray-800",children:t.studentId.nis})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:t.status||"",onChange:s=>h(t.studentId.nis,s.target.value),className:"border p-1 rounded-full active:ring-2 active:ring-blue-300 h-min",disabled:t.status==="Hadir"||t.status==="Terlambat",children:[e.jsx("option",{value:null,children:"Tanpa Keterangan"}),e.jsx("option",{value:"Hadir",disabled:!0,children:"Hadir"}),e.jsx("option",{value:"Terlambat",disabled:!0,children:"Terlambat"}),e.jsx("option",{value:"Sakit",children:"Sakit"}),e.jsx("option",{value:"Izin",children:"Izin"})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{type:"button",className:`border p-1 px-2 rounded-full active:ring-2 active:ring-blue-300 bg-white flex justify-between items-center ${(t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan")&&"hidden"}`,onClick:()=>I(t.studentId.nis),children:["Catatan",m[t.studentId.nis]?e.jsx(A,{size:16}):e.jsx(D,{size:16})]}),e.jsx(z,{children:m[t.studentId.nis]&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"backInOut"},children:e.jsx("div",{className:"mt-2 mr-4 rounded-md bg-white ring-1 ring-black ring-opacity-5",children:e.jsx("div",{className:"flex flex-col py-2",children:e.jsx("div",{className:"px-2 inline-flex items-center",children:e.jsx("input",{type:"text",onChange:s=>b(t.studentId.nis,s.target.value),value:t.teachersNotes,className:`w-full p-2 mb-1 border rounded-sm shadow-sm hover:ring-1 hover:ring-primary focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 ${t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan"?"bg-gray-200 cursor-not-allowed":""}`,disabled:t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan"})})})})})})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{type:"button",className:`border p-1 px-2 rounded-full active:ring-2 active:ring-blue-300 bg-white flex justify-between items-center ${(t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan")&&"hidden"}`,onClick:()=>o(t.studentId.nis),children:["Temuan",u[t.studentId.nis]?e.jsx(A,{size:16}):e.jsx(D,{size:16})]}),e.jsx(z,{children:u[t.studentId.nis]&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"backInOut"},children:e.jsx("div",{className:"mt-2 mr-4 rounded-md bg-white ring-1 ring-black ring-opacity-5",children:e.jsxs("div",{className:"flex flex-col py-2",children:[e.jsxs("div",{className:"px-2 inline-flex items-center",children:[e.jsxs("label",{className:"flex items-center cursor-pointer p-2 relative",htmlFor:t.studentId.nis+"attribute",children:[e.jsx("input",{type:"checkbox",checked:!!t.violations.attribute,onChange:()=>x(t.studentId.nis,"Attribute"),className:"peer h-4 w-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-primary checked:border-primary",id:t.studentId.nis+"attribute",disabled:t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan"}),e.jsx("span",{className:"absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx(w,{})})]}),e.jsx("label",{className:"cursor-pointer text-sm",htmlFor:t.studentId.nis+"attribute",children:"Atribut"})]}),e.jsxs("div",{className:"px-2 inline-flex items-center",children:[e.jsxs("label",{className:"flex items-center cursor-pointer p-2 relative",htmlFor:t.studentId.nis+"attitude",children:[e.jsx("input",{type:"checkbox",checked:!!t.violations.attitude,onChange:()=>x(t.studentId.nis,"Attitude"),className:"peer h-4 w-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-primary checked:border-primary",id:t.studentId.nis+"attitude",disabled:t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan"}),e.jsx("span",{className:"absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx(w,{})})]}),e.jsx("label",{className:"cursor-pointer text-sm",htmlFor:t.studentId.nis+"attitude",children:"Sikap"})]}),e.jsxs("div",{className:"px-2 inline-flex items-center",children:[e.jsxs("label",{className:"flex items-center cursor-pointer p-2 relative",htmlFor:t.studentId.nis+"tidiness",children:[e.jsx("input",{type:"checkbox",checked:!!t.violations.tidiness,onChange:()=>x(t.studentId.nis,"tidiness"),className:"peer h-4 w-4 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-slate-300 checked:bg-primary checked:border-primary",id:t.studentId.nis+"tidiness",disabled:t.status==="Sakit"||t.status==="Izin"||t.status==="Tanpa Keterangan"}),e.jsx("span",{className:"absolute text-white opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx(w,{})})]}),e.jsx("label",{className:"cursor-pointer text-sm",htmlFor:t.studentId.nis+"tidiness",children:"Kerapihan"})]})]})})})})]})]})]})]},t.studentId.nis))}),a.isTeachingGroupYearActivated===!0&&a.studentList.length!==0&&e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l("Sakit"),className:"btn-mobile-secondary-outline",disabled:a.studentList.filter(t=>t.isSelected===!0).length===0,children:"Sakit"}),e.jsx("button",{onClick:()=>l("Izin"),className:"btn-mobile-danger-outline",disabled:a.studentList.filter(t=>t.isSelected===!0).length===0,children:"Izin"})]})})]})},ne=()=>{const{error:a,sendRequest:r,setError:p}=F(),[d,c]=n.useState(!0),{state:i,dispatch:u,fetchAttendanceData:f}=n.useContext(T),m=K(),k=n.useContext(G).userClassIds,h=O().classId;n.useEffect(()=>{c(!0);let b;h?(b=new Date().toLocaleDateString("en-CA"),f(h,b,u)):m("/scan/select-class"),c(!1)},[k,h]);const x=async()=>{if(c(!0),i.studentList.length===0){const b="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/create-new-attendances",g=JSON.stringify({classId:h});try{await r(b,"POST",g,{"Content-Type":"application/json"});const j=new Date().toLocaleDateString("en-CA");await f(h,j,u),m(`/scan/class/${h}`,{replace:!0})}catch(j){console.error(j)}}c(!1)};return console.log(i),e.jsxs("div",{className:"flex flex-col pb-24",children:[e.jsx(C,{variant:2,children:e.jsx(U,{})}),d&&e.jsx("div",{className:"flex justify-center mt-16 ",children:e.jsx(P,{size:32})}),!d&&e.jsxs(C,{variant:2,children:[i.studentList.length===0&&!d&&e.jsxs("div",{className:"card-basic m-4 justify-between items-center flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>x(),className:"btn-mobile-primary rounded-full w-full",disabled:i.isTeachingGroupYearActivated===!1,children:"Buat daftar hadir hari ini"}),i.isTeachingGroupYearActivated===!1?e.jsx("span",{className:"text-danger",children:"Tahun ajaran belum aktif, hubungi Kelompok!"}):""]}),i.studentList.length!==0&&!d&&e.jsxs(e.Fragment,{children:[i.isTeachingGroupYearActivated===!0&&e.jsx("div",{className:"card-basic m-4",children:e.jsx(V,{})}),i.isTeachingGroupYearActivated===!1?e.jsx(R,{className:"mx-4 my-12",children:e.jsx("p",{children:"Tahun ajaran belum aktif, hubungi Kelompok!"})}):""]}),e.jsx(q,{})]})]})};export{ne as default};
