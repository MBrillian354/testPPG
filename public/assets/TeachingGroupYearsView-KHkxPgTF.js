import{r as h,A as L,u as H,j as e,b as C,L as y}from"./index-CUVeWTx6.js";import{u as K}from"./http-hook-BiPXVO_k.js";import{M as P}from"./ModalBottomClose-We_XnTjp.js";import{E as S}from"./ErrorCard-IpMuaMVp.js";import{P as O}from"./plus-BUkQv9Tp.js";import{T as B}from"./trash-DzB1P7l8.js";import{L as R}from"./lock-gAUrXvtR.js";import{L as _}from"./lock-open-Dp4OxJi_.js";import"./createLucideIcon-HjXMmH3n.js";const X=()=>{const[p,n]=h.useState({title:"",message:"",onConfirm:null}),[k,m]=h.useState(!1),[v,w]=h.useState(null),[g,x]=h.useState(),{isLoading:f,error:b,sendRequest:o,setError:G}=K(),c=h.useContext(L),N=H();h.useEffect(()=>{(async()=>{try{const s=await o(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/teachingGroup/${c.userTeachingGroupId}`);x(s)}catch{}})()},[o]);const j=a=>{const s=a.substring(0,4),t=a.substring(4);return`${s}/${parseInt(s)+1} ${t==="1"?"Ganjil":"Genap"}`},Y=a=>{w(v===a?null:a)},T=(a,s)=>t=>{t.stopPropagation(),console.log(a);const u=async()=>{console.log("Updating ... ");const l="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/activate",d=JSON.stringify({teachingGroupYearId:a,semesterTarget:20});console.log(d);let r;try{r=await o(l,"PATCH",d,{"Content-Type":"application/json"})}catch(E){n({title:"Gagal!",message:E.message,onConfirm:null}),m(!0)}n({title:"Berhasil!",message:r.message,onConfirm:null});const i=await o(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/teachingGroup/${c.userTeachingGroupId}`);x(i)};n({title:"Konfirmasi",message:`Aktifkan tahun ajaran ${j(s)}?`,onConfirm:u}),m(!0)},$=(a,s,t)=>{a.stopPropagation();const u=async()=>{const l="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/deactivate",d=JSON.stringify({teachingGroupYearId:t});let r;try{r=await o(l,"PATCH",d,{"Content-Type":"application/json"}),n({title:"Berhasil!",message:r.message,onConfirm:null});const i=await o(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/teachingGroup/${c.userTeachingGroupId}`);x(i)}catch(i){n({title:"Gagal!",message:i.message,onConfirm:null})}};n({title:"Konfirmasi",message:`Nonaktifkan tahun ajaran ${j(s)}?`,onConfirm:u}),m(!0)},A=(a,s,t)=>{a.stopPropagation(),console.log(t);const u=async()=>{const l="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/",d=JSON.stringify({teachingGroupYearId:t});let r;try{r=await o(l,"DELETE",d,{"Content-Type":"application/json"}),n({title:"Berhasil!",message:r.message,onConfirm:null});const i=await o(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/teachingGroup/${c.userTeachingGroupId}`);x(i)}catch(i){n({title:"Gagal!",message:i.message,onConfirm:null})}};n({title:"Konfirmasi Penghapusan",message:`Hapus tahun ajaran ${j(s)}?`,onConfirm:u}),m(!0)},I=(a,s,t)=>{a.stopPropagation(),console.log(t);const u=async()=>{const l="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/classes/";console.log(l);const d=JSON.stringify({classId:t});let r;try{r=await o(l,"DELETE",d,{"Content-Type":"application/json"}),n({title:"Berhasil!",message:r.message,onConfirm:null});const i=await o(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/teachingGroup/${c.userTeachingGroupId}`);x(i)}catch(i){n({title:"Gagal!",message:i.message,onConfirm:null})}};n({title:"Konfirmasi Penghapusan",message:`Hapus Kelas: ${s}?`,onConfirm:u}),m(!0)},D=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>m(!1),className:`${p.onConfirm?"btn-danger-outline":"button-primary mt-0 "}`,children:p.onConfirm?"Batal":"Tutup"}),p.onConfirm&&e.jsx("button",{onClick:p.onConfirm,className:"button-primary mt-0 ",children:"Ya"})]});return e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:e.jsxs("main",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Daftar Tahun Ajaran KA"}),c.userRole==="admin ka"&&e.jsx(C,{to:"/settings/academic/new",children:e.jsxs("button",{className:"button-primary pl-[8px]",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Tambah"]})})]}),e.jsxs(P,{isOpen:k,onClose:()=>m(!1),title:p.title,footer:e.jsx(D,{}),children:[f&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(y,{size:32})}),!f&&p.message]}),(!g||f)&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(y,{size:32})}),b&&e.jsx(S,{error:b,onClear:()=>G(null)}),g&&!f&&e.jsxs(e.Fragment,{children:[g.teachingGroupYears.length===0&&e.jsx("div",{className:"bg-white rounded-md shadow-md p-6 border border-gray-200",children:e.jsx("p",{className:"text-gray-700 text-center",children:"Belum ada tahun ajaran terdaftar."})}),g.teachingGroupYears.length>0&&e.jsx("div",{className:"flex flex-col items-stretch gap-4",children:g.teachingGroupYears.map(a=>e.jsxs("div",{className:`bg-white rounded-md shadow-md overflow-hidden transition-all duration-200
                  ${a.academicYearId.isActive===!0,""}`,children:[e.jsxs("div",{onClick:()=>Y(a._id),className:"p-6 cursor-pointer hover:bg-gray-50 transition-colors duration-200",children:[e.jsxs("div",{className:"flex md:justify-between items-start md:flex-row flex-col md:items-center w-full",children:[e.jsxs("div",{className:"flex gap-2 flex-row flex-wrap",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-800",children:j(a.academicYearId.name)}),e.jsxs("div",{className:"flex gap-2",children:[a.academicYearId.isActive&&e.jsxs("div",{className:"inline-block px-2 py-1 text-sm text-blue-600 bg-blue-100 rounded",children:[a.academicYearId.isActive,"Semester Berjalan"]}),e.jsx("div",{className:`inline-block px-2 py-1 text-sm ${a.isActive?"text-green-600 bg-green-100":a.academicYearId.isActive?"text-red-600 bg-red-100":"text-gray-600 bg-gray-100"} rounded`,children:a.isActive?"Aktif":a.academicYearId.isActive?"Nonaktif":"Semester Lewat"})]})]}),a.academicYearId.isActive&&!a.isActive?e.jsxs("div",{className:"flex justify-between md:justify-end items-center w-full",children:[e.jsxs("div",{className:"flex gap-2 my-6 md:my-0",children:[e.jsx("div",{onClick:()=>N("/settings/academic/classes/new",{state:a.id}),className:"btn-primary-outline m-0 text-gray-700",children:"Tambah Kelas"}),c.userRole==="admin ka"&&e.jsx("div",{onClick:T(a._id,a.name),className:"btn-primary-outline m-0 text-gray-700",children:"Aktifkan"})]}),c.userRole==="admin ka"&&e.jsx("button",{onClick:s=>A(s,a.academicYearId.name,a._id),className:"p-3 rounded-full text-gray-400 hover:bg-gray-200 hover:text-red-500 transition",children:e.jsx(B,{size:20})})]}):c.userRole==="admin ka"&&a.isActive&&e.jsx("div",{onClick:s=>$(s,a.academicYearId.name,a._id),className:"btn-danger-outline m-0 text-gray-700 mt-4 md:mt-0",children:"Nonaktifkan"})]}),e.jsxs("div",{className:"mt-2 text-gray-700",children:["Jumlah Kelas: ",a.classes.length]})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ${v===a._id?"max-h-96":"max-h-0"}`,children:e.jsx("div",{className:"border-t",children:a.classes.length>0?e.jsx("ul",{className:"",children:a.classes.map(s=>e.jsxs("li",{className:"flex justify-start",children:[e.jsx(C,{to:`/dashboard/classes/${s.id}`,className:"grow",children:e.jsxs("div",{className:"flex justify-start items-center gap-2 p-4 border-t text-gray-700 border-gray-200 bg-white hover:bg-gray-100 hover:cursor-pointer",children:[e.jsx("div",{children:s.name}),a.academicYearId.isActive&&e.jsx("div",{className:`flex justify-center items-center p-1 border rounded-md border-gray-300 italic size-6 ${s.isLocked?"text-green-400 border-green-400":"text-red-400 border-red-400"}`,children:s.isLocked?e.jsx(R,{size:16}):e.jsx(_,{size:16})})]})}),c.userRole==="admin ka"&&a.academicYearId.isActive&&!a.isActive&&e.jsx("button",{onClick:t=>I(t,s.name,s.id),className:"border-t px-4 italic text-gray-500 hover:underline hover:text-red-500 hover:cursor-pointer",children:"Hapus Kelas"})]},s._id))}):e.jsxs("p",{className:"p-4 text-gray-500 italic",children:["Tidak ada riwayat kelas.",a.academicYearId.isActive&&e.jsx("span",{onClick:()=>N("/settings/academic/classes/new",{state:a.id}),className:"text-gray-800 hover:underline hover:cursor-pointer",children:"Tambah Kelas"})]})})})]},a._id))})]})]})})};export{X as default};
