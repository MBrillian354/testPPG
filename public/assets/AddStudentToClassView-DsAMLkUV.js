import{r as o,u as P,A as T,a as I,j as e,L as m}from"./index-CUVeWTx6.js";import{u as E}from"./http-hook-BiPXVO_k.js";import{M as G}from"./ModalBottomClose-We_XnTjp.js";import{E as O}from"./ErrorCard-IpMuaMVp.js";const L=()=>{const[r,u]=o.useState({title:"",message:"",onConfirm:null}),[N,c]=o.useState(!1),[d,p]=o.useState(),[g,C]=o.useState();o.useState();const{isLoading:t,error:h,sendRequest:n,setError:v}=E();P();const x=o.useContext(T),f=x.userTeachingGroupId,j=I().classId,w=x.currentTeachingGroupYear;console.log(w),o.useEffect(()=>{const s=async()=>{try{const a=await n(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/students/teaching-group/${f}`);p(a.students)}catch{}},l=async()=>{try{const a=await n(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/classes/${j}`);console.log(a.class);try{const i=await n(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/classes/teachingGroupYear/${a.class.teachingGroupYearId}`);C(i.classes),console.log(JSON.stringify(i.classes))}catch{}}catch{}};s(),l()},[n,r]);const k=(s,l)=>{const a=async()=>{c(!1);const i="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/classes/register-student",D=JSON.stringify({classId:j,studentId:l});let b;try{b=await n(i,"POST",D,{"Content-Type":"application/json"}),c(!0),u({title:"Berhasil!",message:b.message,onConfirm:null});const y=await n(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/students/teaching-group/${f}`);p(y.students)}catch{}};u({title:"Konfirmasi Pendaftaran",message:`Daftarkan peserta didik ${s}?`,onConfirm:a}),c(!0)},$=s=>s==null?void 0:s.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2),S=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{c(!1)},className:`${r.onConfirm?"btn-danger-outline":"button-primary mt-0 "} ${t?"opacity-50 cursor-not-allowed":""}`,disabled:t,children:t?e.jsx(m,{}):r.onConfirm?"Batal":"Tutup"}),r.onConfirm&&e.jsx("button",{onClick:r.onConfirm,className:`button-primary mt-0 ${t?"opacity-50 cursor-not-allowed":""}`,children:t?e.jsx(m,{}):"Ya"})]});return e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Daftarkan Peserta Didik ke Kelas"}),h&&e.jsx(O,{error:h,onClear:()=>v(null)}),e.jsxs(G,{isOpen:N,onClose:()=>c(!1),title:r.title,footer:e.jsx(S,{}),children:[t&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(m,{size:32})}),!t&&r.message]}),(!d||t)&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(m,{size:32})}),d&&!t&&e.jsxs(e.Fragment,{children:[d.length===0&&e.jsx("div",{className:"bg-white rounded-md shadow-md p-6 border border-gray-200",children:e.jsx("p",{className:"text-gray-700 text-center",children:"DPD belum menyediakan daftar siswa. Hubungi pihak terkait"})}),d.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>{const a=(()=>{if(!g)return!1;for(const i of g)if(i.students.includes(s.id))return!0;return!1})();return e.jsx("div",{className:`p-4 border rounded-lg transition-all duration-300 ${a||s.isProfileComplete===!1?"bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed":"bg-white border-gray-200 hover:ring-4 hover:ring-blue-200 hover:border-blue-500 hover:shadow-xl cursor-pointer"}`,onClick:!a&&s.isProfileComplete===!0?()=>k(s.name,s.id):void 0,children:e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[s.image?e.jsx("img",{src:s!=null&&s.image?`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/${s.image}`:"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541",alt:s.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"flex w-10 h-10 rounded-full bg-blue-200 text-blue-500 items-center justify-center font-medium",children:$(s.name)}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h2",{className:"text-lg font-medium",children:s.name}),e.jsx("h3",{className:"text-base font-normal",children:s.nis})]})]}),s.isProfileComplete===!1?e.jsx("span",{className:"text-sm font-medium text-red-500",children:"Lengkapi Profil!"}):a?e.jsx("span",{className:"text-sm font-base text-gray-500",children:"Terdaftar âœ“"}):e.jsx("span",{className:"text-sm font-medium text-blue-500 hidden hover:block",children:"Register"})]})},s._id)})})]})]})})};export{L as default};
