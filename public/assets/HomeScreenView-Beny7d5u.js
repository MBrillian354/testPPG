var ue=t=>{throw TypeError(t)};var J=(t,e,s)=>e.has(t)||ue("Cannot "+s);var i=(t,e,s)=>(J(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>e.has(t)?ue("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,r)=>(J(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),x=(t,e,s)=>(J(t,e,"access private method"),s);import{d as Ce,p as de,e as N,s as K,f as z,n as je,i as Z,g as fe,t as Ie,h as we,k as Se,l as pe,m as ve,r as j,o as Ne,S as Ee,j as n,A as Te,q as De,L as Oe,b as Qe}from"./index-CUVeWTx6.js";import{S as ke}from"./SequentialAnimation-BQQ2C5H-.js";import{I as Fe}from"./InfoCard-Clv7xmeM.js";import"./proxy-G5p5AvPC.js";var C,o,H,R,Q,A,D,S,$,L,_,k,F,O,M,h,G,X,ee,te,se,ie,re,ae,ye,be,Ue=(be=class extends Ce{constructor(e,s){super();b(this,h);b(this,C);b(this,o);b(this,H);b(this,R);b(this,Q);b(this,A);b(this,D);b(this,S);b(this,$);b(this,L);b(this,_);b(this,k);b(this,F);b(this,O);b(this,M,new Set);this.options=s,d(this,C,e),d(this,S,null),d(this,D,de()),this.options.experimental_prefetchInRender||i(this,D).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,o).addObserver(this),me(i(this,o),this.options)?x(this,h,G).call(this):this.updateResult(),x(this,h,se).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ne(i(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ne(i(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,x(this,h,ie).call(this),x(this,h,re).call(this),i(this,o).removeObserver(this)}setOptions(e,s){const r=this.options,l=i(this,o);if(this.options=i(this,C).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof N(this.options.enabled,i(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");x(this,h,ae).call(this),i(this,o).setOptions(this.options),r._defaulted&&!K(this.options,r)&&i(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,o),observer:this});const c=this.hasListeners();c&&ge(i(this,o),l,this.options,r)&&x(this,h,G).call(this),this.updateResult(s),c&&(i(this,o)!==l||N(this.options.enabled,i(this,o))!==N(r.enabled,i(this,o))||z(this.options.staleTime,i(this,o))!==z(r.staleTime,i(this,o)))&&x(this,h,X).call(this);const a=x(this,h,ee).call(this);c&&(i(this,o)!==l||N(this.options.enabled,i(this,o))!==N(r.enabled,i(this,o))||a!==i(this,O))&&x(this,h,te).call(this,a)}getOptimisticResult(e){const s=i(this,C).getQueryCache().build(i(this,C),e),r=this.createResult(s,e);return Ae(this,r)&&(d(this,R,r),d(this,A,this.options),d(this,Q,i(this,o).state)),r}getCurrentResult(){return i(this,R)}trackResult(e,s){const r={};return Object.keys(e).forEach(l=>{Object.defineProperty(r,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),s==null||s(l),e[l])})}),r}trackProp(e){i(this,M).add(e)}getCurrentQuery(){return i(this,o)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,C).defaultQueryOptions(e),r=i(this,C).getQueryCache().build(i(this,C),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return x(this,h,G).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,R)))}createResult(e,s){var le;const r=i(this,o),l=this.options,c=i(this,R),a=i(this,Q),p=i(this,A),m=e!==r?e.state:i(this,H),{state:g}=e;let u={...g},I=!1,v;if(s._optimisticResults){const y=this.hasListeners(),U=!y&&me(e,s),P=y&&ge(e,r,s,l);(U||P)&&(u={...u,...Se(g.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:B,errorUpdatedAt:T,status:E}=u;if(s.select&&u.data!==void 0)if(c&&u.data===(a==null?void 0:a.data)&&s.select===i(this,$))v=i(this,L);else try{d(this,$,s.select),v=s.select(u.data),v=pe(c==null?void 0:c.data,v,s),d(this,L,v),d(this,S,null)}catch(y){d(this,S,y)}else v=u.data;if(s.placeholderData!==void 0&&v===void 0&&E==="pending"){let y;if(c!=null&&c.isPlaceholderData&&s.placeholderData===(p==null?void 0:p.placeholderData))y=c.data;else if(y=typeof s.placeholderData=="function"?s.placeholderData((le=i(this,_))==null?void 0:le.state.data,i(this,_)):s.placeholderData,s.select&&y!==void 0)try{y=s.select(y),d(this,S,null)}catch(U){d(this,S,U)}y!==void 0&&(E="success",v=pe(c==null?void 0:c.data,y,s),I=!0)}i(this,S)&&(B=i(this,S),v=i(this,L),T=Date.now(),E="error");const Y=u.fetchStatus==="fetching",V=E==="pending",W=E==="error",ce=V&&Y,he=v!==void 0,w={status:E,fetchStatus:u.fetchStatus,isPending:V,isSuccess:E==="success",isError:W,isInitialLoading:ce,isLoading:ce,data:v,dataUpdatedAt:u.dataUpdatedAt,error:B,errorUpdatedAt:T,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>m.dataUpdateCount||u.errorUpdateCount>m.errorUpdateCount,isFetching:Y,isRefetching:Y&&!V,isLoadingError:W&&!he,isPaused:u.fetchStatus==="paused",isPlaceholderData:I,isRefetchError:W&&he,isStale:oe(e,s),refetch:this.refetch,promise:i(this,D)};if(this.options.experimental_prefetchInRender){const y=q=>{w.status==="error"?q.reject(w.error):w.data!==void 0&&q.resolve(w.data)},U=()=>{const q=d(this,D,w.promise=de());y(q)},P=i(this,D);switch(P.status){case"pending":e.queryHash===r.queryHash&&y(P);break;case"fulfilled":(w.status==="error"||w.data!==P.value)&&U();break;case"rejected":(w.status!=="error"||w.error!==P.reason)&&U();break}}return w}updateResult(e){const s=i(this,R),r=this.createResult(i(this,o),this.options);if(d(this,Q,i(this,o).state),d(this,A,this.options),i(this,Q).data!==void 0&&d(this,_,i(this,o)),K(r,s))return;d(this,R,r);const l={},c=()=>{if(!s)return!0;const{notifyOnChangeProps:a}=this.options,p=typeof a=="function"?a():a;if(p==="all"||!p&&!i(this,M).size)return!0;const f=new Set(p??i(this,M));return this.options.throwOnError&&f.add("error"),Object.keys(i(this,R)).some(m=>{const g=m;return i(this,R)[g]!==s[g]&&f.has(g)})};(e==null?void 0:e.listeners)!==!1&&c()&&(l.listeners=!0),x(this,h,ye).call(this,{...l,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&x(this,h,se).call(this)}},C=new WeakMap,o=new WeakMap,H=new WeakMap,R=new WeakMap,Q=new WeakMap,A=new WeakMap,D=new WeakMap,S=new WeakMap,$=new WeakMap,L=new WeakMap,_=new WeakMap,k=new WeakMap,F=new WeakMap,O=new WeakMap,M=new WeakMap,h=new WeakSet,G=function(e){x(this,h,ae).call(this);let s=i(this,o).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(je)),s},X=function(){x(this,h,ie).call(this);const e=z(this.options.staleTime,i(this,o));if(Z||i(this,R).isStale||!fe(e))return;const r=Ie(i(this,R).dataUpdatedAt,e)+1;d(this,k,setTimeout(()=>{i(this,R).isStale||this.updateResult()},r))},ee=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,o)):this.options.refetchInterval)??!1},te=function(e){x(this,h,re).call(this),d(this,O,e),!(Z||N(this.options.enabled,i(this,o))===!1||!fe(i(this,O))||i(this,O)===0)&&d(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||we.isFocused())&&x(this,h,G).call(this)},i(this,O)))},se=function(){x(this,h,X).call(this),x(this,h,te).call(this,x(this,h,ee).call(this))},ie=function(){i(this,k)&&(clearTimeout(i(this,k)),d(this,k,void 0))},re=function(){i(this,F)&&(clearInterval(i(this,F)),d(this,F,void 0))},ae=function(){const e=i(this,C).getQueryCache().build(i(this,C),this.options);if(e===i(this,o))return;const s=i(this,o);d(this,o,e),d(this,H,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},ye=function(e){ve.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,R))}),i(this,C).getQueryCache().notify({query:i(this,o),type:"observerResultsUpdated"})})},be);function Pe(t,e){return N(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function me(t,e){return Pe(t,e)||t.state.data!==void 0&&ne(t,e,e.refetchOnMount)}function ne(t,e,s){if(N(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&oe(t,e)}return!1}function ge(t,e,s,r){return(t!==e||N(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&oe(t,s)}function oe(t,e){return N(e.enabled,t)!==!1&&t.isStaleByTime(z(e.staleTime,t))}function Ae(t,e){return!K(t.getCurrentResult(),e)}var Re=j.createContext(!1),Le=()=>j.useContext(Re);Re.Provider;function _e(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Me=j.createContext(_e()),Be=()=>j.useContext(Me);function Ge(t,e){return typeof t=="function"?t(...e):!!t}function He(){}var $e=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},qe=t=>{j.useEffect(()=>{t.clearReset()},[t])},ze=({result:t,errorResetBoundary:e,throwOnError:s,query:r})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&Ge(s,[t.error,r]),Ye=t=>{t.suspense&&(t.staleTime===void 0&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Ve=(t,e)=>t.isLoading&&t.isFetching&&!e,We=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,xe=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function Je(t,e,s){var g,u,I,v,B;const r=Ne(),l=Le(),c=Be(),a=r.defaultQueryOptions(t);(u=(g=r.getDefaultOptions().queries)==null?void 0:g._experimental_beforeQuery)==null||u.call(g,a),a._optimisticResults=l?"isRestoring":"optimistic",Ye(a),$e(a,c),qe(c);const p=!r.getQueryCache().get(a.queryHash),[f]=j.useState(()=>new e(r,a)),m=f.getOptimisticResult(a);if(j.useSyncExternalStore(j.useCallback(T=>{const E=l?()=>{}:f.subscribe(ve.batchCalls(T));return f.updateResult(),E},[f,l]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),j.useEffect(()=>{f.setOptions(a,{listeners:!1})},[a,f]),We(a,m))throw xe(a,f,c);if(ze({result:m,errorResetBoundary:c,throwOnError:a.throwOnError,query:r.getQueryCache().get(a.queryHash)}))throw m.error;if((v=(I=r.getDefaultOptions().queries)==null?void 0:I._experimental_afterQuery)==null||v.call(I,a,m),a.experimental_prefetchInRender&&!Z&&Ve(m,l)){const T=p?xe(a,f,c):(B=r.getQueryCache().get(a.queryHash))==null?void 0:B.promise;T==null||T.catch(He).finally(()=>{f.updateResult()})}return a.notifyOnChangeProps?m:f.trackResult(m)}function Ke(t,e){return Je(t,Ue)}const Ze=({user:t,isLoading:e})=>{var c,a,p,f,m;const s=j.useContext(Ee),r=()=>{s.toggle()},l=g=>g==null?void 0:g.split(" ").map(u=>u[0]).join("").toUpperCase().slice(0,2);return n.jsx("div",{className:"bg-white mb-2 p-4 shadow-sm fixed top-0 w-full ",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[!e&&(t!=null&&t.image)?n.jsx("img",{onClick:r,src:`http://192.168.1.13:5000/api/${t.image}`,alt:t.name,className:"w-12 h-12 rounded-full  focus:bg-gray-200 hover:outline-none hover:ring-1 hover:ring-offset-1 hover:ring-gray-400"}):n.jsx("div",{onClick:r,className:`${e&&"animate-pulse"} w-12 h-12 rounded-full bg-green-200 text-green-500 flex items-center justify-center font-medium  focus:bg-gray-200 hover:outline-none hover:ring-1 hover:ring-offset-1 hover:ring-gray-400`,children:l(t==null?void 0:t.name)}),n.jsxs("div",{children:[e&&n.jsx("div",{className:"animate-pulse flex space-x-4",children:n.jsxs("div",{className:"flex-1 space-y-3 py-1 grow",children:[n.jsx("div",{className:"h-5 w-36 bg-slate-700 rounded"}),n.jsx("div",{className:"h-3 w-56 bg-slate-400 rounded"})]})}),!e&&n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-medium",children:t.name||"Unknown"}),n.jsxs("h3",{children:[((a=(c=t.userId)==null?void 0:c.teachingGroupId)==null?void 0:a.name)||"No TeachingGroup"," - ",((m=(f=(p=t.userId)==null?void 0:p.teachingGroupId)==null?void 0:f.branchId)==null?void 0:m.name)||"No Branch"]})]})]})]})})},Xe=({data:t})=>{var s,r;const e=l=>{const c=l.attendances,a=new Set;return c.forEach(p=>{a.add(p.forDate)}),a.size};return n.jsxs("div",{className:"my-8",children:[n.jsx("h2",{className:"text-xl font-medium mb-2 ",children:t.name}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{className:"bg-white p-4 rounded-md shadow",children:[n.jsx("h3",{className:"text-gray-500 text-sm",children:"Jumlah Peserta Didik"}),n.jsx("p",{className:"text-2xl font-bold",children:((s=t.students)==null?void 0:s.length)||"No Data"})]}),n.jsxs("div",{className:"bg-white p-4 rounded-md shadow",children:[n.jsx("h3",{className:"text-gray-500 text-sm",children:"Total Pertemuan"}),n.jsx("p",{className:"text-2xl font-bold",children:t.attendances&&((r=t.teachingGroupYearId)!=null&&r.semesterTarget)?`${e(t)}`:"No Data"})]})]})]})},et=()=>{const[t,e]=j.useState(new Date);j.useEffect(()=>{const l=setInterval(()=>{e(new Date)},1e3);return()=>{clearInterval(l)}},[]);const s=l=>l.toLocaleDateString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),r=l=>l.toLocaleTimeString("id-ID",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Jakarta"});return n.jsxs("div",{className:"space-y-1 mb-2 text-gray-600",children:[n.jsx("div",{className:"font-normal",children:s(t)}),n.jsxs("div",{className:"",children:[r(t)," WIB"]})]})},ot=()=>{const t=j.useContext(Te);j.useContext(De);const e=async()=>{var m,g,u,I;console.log("fetching profile...");const a=await fetch(`http://192.168.1.13:5000/api/teachers/user/${t.userId}`);if(!a.ok)throw new Error("Failed to fetch user data");const p=await a.json();console.log(p);const f=((m=p.teacher)==null?void 0:m.classIds.map(v=>v._id))||[];return t.setAttributes((I=(u=(g=p.teacher)==null?void 0:g.userId)==null?void 0:u.teachingGroupId)==null?void 0:I.id,f),p.teacher},{data:s,isLoading:r,error:l}=Ke({queryKey:["teacherData"],queryFn:e,staleTime:1e3*60*5});let c=0;return console.log(c),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{children:n.jsx(Ze,{user:s,isLoading:r})}),!s&&r&&n.jsx("div",{className:"flex justify-center mt-44",children:n.jsx(Oe,{size:32})}),s&&!r&&n.jsx(ke,{children:n.jsxs("div",{className:"mt-20 flex-1 p-4",children:[n.jsxs("div",{className:"mb-4 space-y-1",children:[n.jsx("h1",{className:"text-xl font-medium",children:"Tenaga Pendidik"}),n.jsx(et,{})]}),n.jsxs("div",{className:"mb-4",children:[s.classIds.map((a,p)=>{var m,g;if((g=(m=a==null?void 0:a.teachingGroupYearId)==null?void 0:m.academicYearId)==null?void 0:g.isActive)return c++,n.jsx(Xe,{data:a},p)}),c===0&&n.jsxs(Fe,{children:[n.jsx("p",{children:"Belum terdaftar di kelas manapun."}),n.jsxs("p",{children:["Buat kelas baru di ",n.jsx(Qe,{to:"/dashboard/academic",className:"active:text-blue-400 underline",children:"pengaturan akademik"})]})]})]})]})})]})};export{ot as default};
