import{a as J,r as t,A as W,u as Q,j as a,L as U,h as X,P as Z,i as ee}from"./index-CQE6waEO.js";const ne=()=>{const{isLoading:j,error:ae,sendRequest:r,setError:se}=J(),[h,$]=t.useState(),[n,E]=t.useState(null),[o,Y]=t.useState(null),[m,_]=t.useState(null),[f,N]=t.useState(),[l,L]=t.useState(null),[b,y]=t.useState(),[i,S]=t.useState(null),[C,g]=t.useState(),[u,v]=t.useState(null),[A,G]=t.useState(),[k,M]=t.useState();t.useContext(W),Q();const P=t.useCallback(async()=>{try{const e=await r("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/academicYears/?populate=teachingGroupYears");$(e.academicYears)}catch{}},[r]),T=t.useCallback(async()=>{const e=x=>{const w=[];x.teachingGroupYears.forEach(c=>{c.classes.forEach(p=>{p.attendances.forEach(F=>{w.push(F.status)})})});const D=w.reduce((c,p)=>(c[p]=(c[p]||0)+1,c),{}),z=w.length;return Object.keys(D).map(c=>({status:c,count:D[c],percentage:Math.round(D[c]/z*100)})).sort((c,p)=>c.status.localeCompare(p.status))},s="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/reports/",d=JSON.stringify({academicYearId:n,branchId:l,teachingGroupId:i,classId:u,startDate:o?o.toISOString():null,endDate:m?m.toISOString():null});console.log(d);try{const x=await r(s,"POST",d,{"Content-Type":"application/json"});G(x),M(e(x))}catch{}},[r,n,l,i,u,o,m]);t.useEffect(()=>{P(),T()},[P,T]);const O=e=>{E(e),setMonthList([]),setSelectedMonth(null),N([]),L(null),y([]),S(null),g([]),v(null),e!==""&&(fetchMonthsData(),H())},H=async()=>{try{const e=await r("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/");N(e.branches)}catch{}},B=e=>{L(e),y([]),S(null),g([]),v(null),e!==""&&R(e)},R=async e=>{try{const s=await r(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/levels/branches/${e}?populate=true`);y(s.branch.teachingGroups)}catch{}},I=e=>{S(e),g([]),v(null),e!==""&&K(e)},K=async e=>{const s=`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachingGroupYears/teaching-group/${e}/academic-year/${n}`;try{const d=await r(s);g(d.teachingGroupYear.classes)}catch{}},V=e=>{v(e)},q=e=>{const[s,d]=e;Y(s),_(d)};return a.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:a.jsxs("main",{className:"max-w-6xl mx-auto",children:[(!h||j)&&a.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex justify-center items-center w-full h-dvh",children:a.jsx(U,{size:32})}),h&&a.jsxs("div",{className:"card-basic flex-col md:flex-row justify-between gap-4",children:[a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[a.jsx("div",{children:"Tahun Ajaran"}),a.jsxs("select",{value:n||"",onChange:e=>O(e.target.value),className:"border border-gray-400 px-2 py-1 rounded-full active:ring-2 active:ring-blue-300",disabled:!1,children:[!n&&a.jsx("option",{value:"",children:"Pilih"}),h&&h.map((e,s)=>a.jsx("option",{value:e._id,children:e.name},s))]})]}),a.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[a.jsx("div",{children:"Periode"}),a.jsx(X,{dateFormat:"dd/MM/yyyy",selected:o,onChange:q,startDate:o,endDate:m,locale:"id-ID",selectsRange:!0,isClearable:!0,withPortal:window.innerWidth<=768,className:`${n&&"pr-8"} border border-gray-400 px-2 py-1 rounded-full active:ring-2 active:ring-blue-300`,disabled:!n,placeholderText:`${n?"Masukkan Periode":"Pilih Tahun Ajaran"}`,style:{width:"233px"}})]}),a.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[a.jsx("div",{children:"Desa"}),a.jsxs("select",{value:l||"",onChange:e=>B(e.target.value),className:"border border-gray-400 px-2 py-1 rounded-full active:ring-2 active:ring-blue-300",disabled:!n,children:[a.jsx("option",{value:"",children:"Semua"}),f&&f.map((e,s)=>a.jsx("option",{value:e._id,children:e.name},s))]})]}),a.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[a.jsx("div",{children:"Kelompok"}),a.jsxs("select",{value:i||"",onChange:e=>I(e.target.value),className:"border border-gray-400 px-2 py-1 rounded-full active:ring-2 active:ring-blue-300",disabled:!l,children:[a.jsx("option",{value:"",children:"Semua"}),b&&b.map((e,s)=>a.jsx("option",{value:e._id,children:e.name},s))]})]}),a.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[a.jsx("div",{children:"Kelas"}),a.jsxs("select",{value:u||"",onChange:e=>V(e.target.value),className:"border border-gray-400 px-2 py-1 rounded-full active:ring-2 active:ring-blue-300",disabled:!i,children:[a.jsx("option",{value:"",children:"Semua"}),C&&C.map((e,s)=>a.jsx("option",{value:e._id,children:e.name},s))]})]}),a.jsxs("div",{className:"flex-col gap-2 border-t py-t mt-4 hidden",children:[a.jsx("div",{children:n?h.map((e,s)=>{if(e._id===n)return a.jsxs("p",{children:[" ",e.name," - ",e.id," "]},s)}):""}),a.jsx("div",{children:l?f.map((e,s)=>{if(e._id===l)return a.jsxs("p",{children:[" ",e.name," - ",e.id," "]},s)}):""}),a.jsx("div",{children:i?b.map((e,s)=>{if(e._id===i)return a.jsxs("p",{children:[" ",e.name," - ",e.id," "]},s)}):""}),a.jsx("div",{children:u?C.map((e,s)=>{if(e._id===u)return a.jsxs("p",{children:[" ",e.name," - ",e.id," "]},s)}):""})]})]}),k&&!j&&n&&a.jsx("div",{className:"",children:a.jsx(Z,{attendanceData:k})})]}),A&&!j&&n&&a.jsx(ee,{data:A,initialView:"branches",startDate:o,endDate:m})]})})};export{ne as default};
