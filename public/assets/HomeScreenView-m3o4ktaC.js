var ue=t=>{throw TypeError(t)};var J=(t,e,s)=>e.has(t)||ue("Cannot "+s);var i=(t,e,s)=>(J(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>e.has(t)?ue("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,r)=>(J(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),g=(t,e,s)=>(J(t,e,"access private method"),s);import{e as Ce,p as de,f as N,s as K,g as q,n as je,i as Z,h as fe,t as Ie,k as we,l as Se,m as pe,o as ve,r as j,q as Ne,S as Te,j as a,A as Ee,v as Oe,L as De,c as Qe}from"./index-CP-NX24X.js";import{a as ke}from"./attendanceCount-EC2MUpAe.js";import{S as Fe}from"./SequentialAnimation-NsWhivPM.js";import{I as Ue}from"./InfoCard-C3ucw4xx.js";import"./proxy-D_5rIsVQ.js";var C,o,H,R,Q,A,O,S,$,L,_,k,F,D,M,h,G,X,ee,te,se,ie,re,ae,ye,be,Pe=(be=class extends Ce{constructor(e,s){super();b(this,h);b(this,C);b(this,o);b(this,H);b(this,R);b(this,Q);b(this,A);b(this,O);b(this,S);b(this,$);b(this,L);b(this,_);b(this,k);b(this,F);b(this,D);b(this,M,new Set);this.options=s,d(this,C,e),d(this,S,null),d(this,O,de()),this.options.experimental_prefetchInRender||i(this,O).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,o).addObserver(this),me(i(this,o),this.options)?g(this,h,G).call(this):this.updateResult(),g(this,h,se).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ne(i(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ne(i(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,g(this,h,ie).call(this),g(this,h,re).call(this),i(this,o).removeObserver(this)}setOptions(e,s){const r=this.options,u=i(this,o);if(this.options=i(this,C).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof N(this.options.enabled,i(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");g(this,h,ae).call(this),i(this,o).setOptions(this.options),r._defaulted&&!K(this.options,r)&&i(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,o),observer:this});const c=this.hasListeners();c&&ge(i(this,o),u,this.options,r)&&g(this,h,G).call(this),this.updateResult(s),c&&(i(this,o)!==u||N(this.options.enabled,i(this,o))!==N(r.enabled,i(this,o))||q(this.options.staleTime,i(this,o))!==q(r.staleTime,i(this,o)))&&g(this,h,X).call(this);const n=g(this,h,ee).call(this);c&&(i(this,o)!==u||N(this.options.enabled,i(this,o))!==N(r.enabled,i(this,o))||n!==i(this,D))&&g(this,h,te).call(this,n)}getOptimisticResult(e){const s=i(this,C).getQueryCache().build(i(this,C),e),r=this.createResult(s,e);return Le(this,r)&&(d(this,R,r),d(this,A,this.options),d(this,Q,i(this,o).state)),r}getCurrentResult(){return i(this,R)}trackResult(e,s){const r={};return Object.keys(e).forEach(u=>{Object.defineProperty(r,u,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(u),s==null||s(u),e[u])})}),r}trackProp(e){i(this,M).add(e)}getCurrentQuery(){return i(this,o)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,C).defaultQueryOptions(e),r=i(this,C).getQueryCache().build(i(this,C),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return g(this,h,G).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,R)))}createResult(e,s){var le;const r=i(this,o),u=this.options,c=i(this,R),n=i(this,Q),x=i(this,A),p=e!==r?e.state:i(this,H),{state:m}=e;let l={...m},I=!1,v;if(s._optimisticResults){const y=this.hasListeners(),U=!y&&me(e,s),P=y&&ge(e,r,s,u);(U||P)&&(l={...l,...Se(m.data,e.options)}),s._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:B,errorUpdatedAt:E,status:T}=l;if(s.select&&l.data!==void 0)if(c&&l.data===(n==null?void 0:n.data)&&s.select===i(this,$))v=i(this,L);else try{d(this,$,s.select),v=s.select(l.data),v=pe(c==null?void 0:c.data,v,s),d(this,L,v),d(this,S,null)}catch(y){d(this,S,y)}else v=l.data;if(s.placeholderData!==void 0&&v===void 0&&T==="pending"){let y;if(c!=null&&c.isPlaceholderData&&s.placeholderData===(x==null?void 0:x.placeholderData))y=c.data;else if(y=typeof s.placeholderData=="function"?s.placeholderData((le=i(this,_))==null?void 0:le.state.data,i(this,_)):s.placeholderData,s.select&&y!==void 0)try{y=s.select(y),d(this,S,null)}catch(U){d(this,S,U)}y!==void 0&&(T="success",v=pe(c==null?void 0:c.data,y,s),I=!0)}i(this,S)&&(B=i(this,S),v=i(this,L),E=Date.now(),T="error");const z=l.fetchStatus==="fetching",V=T==="pending",W=T==="error",ce=V&&z,he=v!==void 0,w={status:T,fetchStatus:l.fetchStatus,isPending:V,isSuccess:T==="success",isError:W,isInitialLoading:ce,isLoading:ce,data:v,dataUpdatedAt:l.dataUpdatedAt,error:B,errorUpdatedAt:E,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>p.dataUpdateCount||l.errorUpdateCount>p.errorUpdateCount,isFetching:z,isRefetching:z&&!V,isLoadingError:W&&!he,isPaused:l.fetchStatus==="paused",isPlaceholderData:I,isRefetchError:W&&he,isStale:oe(e,s),refetch:this.refetch,promise:i(this,O)};if(this.options.experimental_prefetchInRender){const y=Y=>{w.status==="error"?Y.reject(w.error):w.data!==void 0&&Y.resolve(w.data)},U=()=>{const Y=d(this,O,w.promise=de());y(Y)},P=i(this,O);switch(P.status){case"pending":e.queryHash===r.queryHash&&y(P);break;case"fulfilled":(w.status==="error"||w.data!==P.value)&&U();break;case"rejected":(w.status!=="error"||w.error!==P.reason)&&U();break}}return w}updateResult(e){const s=i(this,R),r=this.createResult(i(this,o),this.options);if(d(this,Q,i(this,o).state),d(this,A,this.options),i(this,Q).data!==void 0&&d(this,_,i(this,o)),K(r,s))return;d(this,R,r);const u={},c=()=>{if(!s)return!0;const{notifyOnChangeProps:n}=this.options,x=typeof n=="function"?n():n;if(x==="all"||!x&&!i(this,M).size)return!0;const f=new Set(x??i(this,M));return this.options.throwOnError&&f.add("error"),Object.keys(i(this,R)).some(p=>{const m=p;return i(this,R)[m]!==s[m]&&f.has(m)})};(e==null?void 0:e.listeners)!==!1&&c()&&(u.listeners=!0),g(this,h,ye).call(this,{...u,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&g(this,h,se).call(this)}},C=new WeakMap,o=new WeakMap,H=new WeakMap,R=new WeakMap,Q=new WeakMap,A=new WeakMap,O=new WeakMap,S=new WeakMap,$=new WeakMap,L=new WeakMap,_=new WeakMap,k=new WeakMap,F=new WeakMap,D=new WeakMap,M=new WeakMap,h=new WeakSet,G=function(e){g(this,h,ae).call(this);let s=i(this,o).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(je)),s},X=function(){g(this,h,ie).call(this);const e=q(this.options.staleTime,i(this,o));if(Z||i(this,R).isStale||!fe(e))return;const r=Ie(i(this,R).dataUpdatedAt,e)+1;d(this,k,setTimeout(()=>{i(this,R).isStale||this.updateResult()},r))},ee=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,o)):this.options.refetchInterval)??!1},te=function(e){g(this,h,re).call(this),d(this,D,e),!(Z||N(this.options.enabled,i(this,o))===!1||!fe(i(this,D))||i(this,D)===0)&&d(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||we.isFocused())&&g(this,h,G).call(this)},i(this,D)))},se=function(){g(this,h,X).call(this),g(this,h,te).call(this,g(this,h,ee).call(this))},ie=function(){i(this,k)&&(clearTimeout(i(this,k)),d(this,k,void 0))},re=function(){i(this,F)&&(clearInterval(i(this,F)),d(this,F,void 0))},ae=function(){const e=i(this,C).getQueryCache().build(i(this,C),this.options);if(e===i(this,o))return;const s=i(this,o);d(this,o,e),d(this,H,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},ye=function(e){ve.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,R))}),i(this,C).getQueryCache().notify({query:i(this,o),type:"observerResultsUpdated"})})},be);function Ae(t,e){return N(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function me(t,e){return Ae(t,e)||t.state.data!==void 0&&ne(t,e,e.refetchOnMount)}function ne(t,e,s){if(N(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&oe(t,e)}return!1}function ge(t,e,s,r){return(t!==e||N(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&oe(t,s)}function oe(t,e){return N(e.enabled,t)!==!1&&t.isStaleByTime(q(e.staleTime,t))}function Le(t,e){return!K(t.getCurrentResult(),e)}var Re=j.createContext(!1),_e=()=>j.useContext(Re);Re.Provider;function Me(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Be=j.createContext(Me()),Ge=()=>j.useContext(Be);function He(t,e){return typeof t=="function"?t(...e):!!t}function $e(){}var Ye=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},qe=t=>{j.useEffect(()=>{t.clearReset()},[t])},ze=({result:t,errorResetBoundary:e,throwOnError:s,query:r})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&He(s,[t.error,r]),Ve=t=>{t.suspense&&(t.staleTime===void 0&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},We=(t,e)=>t.isLoading&&t.isFetching&&!e,Je=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,xe=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function Ke(t,e,s){var m,l,I,v,B;const r=Ne(),u=_e(),c=Ge(),n=r.defaultQueryOptions(t);(l=(m=r.getDefaultOptions().queries)==null?void 0:m._experimental_beforeQuery)==null||l.call(m,n),n._optimisticResults=u?"isRestoring":"optimistic",Ve(n),Ye(n,c),qe(c);const x=!r.getQueryCache().get(n.queryHash),[f]=j.useState(()=>new e(r,n)),p=f.getOptimisticResult(n);if(j.useSyncExternalStore(j.useCallback(E=>{const T=u?()=>{}:f.subscribe(ve.batchCalls(E));return f.updateResult(),T},[f,u]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),j.useEffect(()=>{f.setOptions(n,{listeners:!1})},[n,f]),Je(n,p))throw xe(n,f,c);if(ze({result:p,errorResetBoundary:c,throwOnError:n.throwOnError,query:r.getQueryCache().get(n.queryHash)}))throw p.error;if((v=(I=r.getDefaultOptions().queries)==null?void 0:I._experimental_afterQuery)==null||v.call(I,n,p),n.experimental_prefetchInRender&&!Z&&We(p,u)){const E=x?xe(n,f,c):(B=r.getQueryCache().get(n.queryHash))==null?void 0:B.promise;E==null||E.catch($e).finally(()=>{f.updateResult()})}return n.notifyOnChangeProps?p:f.trackResult(p)}function Ze(t,e){return Ke(t,Pe)}const Xe=({user:t,isLoading:e})=>{var c,n,x,f,p;const s=j.useContext(Te),r=()=>{s.toggle()},u=m=>m==null?void 0:m.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2);return a.jsx("div",{className:"bg-white mb-2 p-4 shadow-sm fixed top-0 w-full ",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[!e&&(t!=null&&t.image)?a.jsx("img",{onClick:r,src:`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/${t.image}`,alt:t.name,className:"w-12 h-12 rounded-full  focus:bg-gray-200 hover:outline-none hover:ring-1 hover:ring-offset-1 hover:ring-gray-400"}):a.jsx("div",{onClick:r,className:`${e&&"animate-pulse"} w-12 h-12 rounded-full bg-green-200 text-green-500 flex items-center justify-center font-medium  focus:bg-gray-200 hover:outline-none hover:ring-1 hover:ring-offset-1 hover:ring-gray-400`,children:u(t==null?void 0:t.name)}),a.jsxs("div",{children:[e&&a.jsx("div",{className:"animate-pulse flex space-x-4",children:a.jsxs("div",{className:"flex-1 space-y-3 py-1 grow",children:[a.jsx("div",{className:"h-5 w-36 bg-slate-700 rounded"}),a.jsx("div",{className:"h-3 w-56 bg-slate-400 rounded"})]})}),!e&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-xl font-medium",children:t.name||"Unknown"}),a.jsxs("h3",{children:[((n=(c=t.userId)==null?void 0:c.teachingGroupId)==null?void 0:n.name)||"No TeachingGroup"," - ",((p=(f=(x=t.userId)==null?void 0:x.teachingGroupId)==null?void 0:f.branchId)==null?void 0:p.name)||"No Branch"]})]})]})]})})},et=({data:t})=>{var e,s;return a.jsxs("div",{className:"my-8",children:[a.jsx("h2",{className:"text-xl font-medium mb-2 ",children:t.name}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h3",{className:"text-gray-500 text-sm",children:"Jumlah Peserta Didik"}),a.jsx("p",{className:"text-2xl font-bold",children:((e=t.students)==null?void 0:e.length)||"No Data"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h3",{className:"text-gray-500 text-sm",children:"Total Pertemuan"}),a.jsx("p",{className:"text-2xl font-bold",children:t.attendances&&((s=t.teachingGroupYearId)!=null&&s.semesterTarget)?`${ke(t)}`:"No Data"})]})]})]})},tt=()=>{const[t,e]=j.useState(new Date);j.useEffect(()=>{const u=setInterval(()=>{e(new Date)},1e3);return()=>{clearInterval(u)}},[]);const s=u=>u.toLocaleDateString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),r=u=>u.toLocaleTimeString("id-ID",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Jakarta"});return a.jsxs("div",{className:"space-y-1 mb-2 text-gray-600",children:[a.jsx("div",{className:"font-normal",children:s(t)}),a.jsxs("div",{className:"",children:[r(t)," WIB"]})]})},ht=()=>{const t=j.useContext(Ee);j.useContext(Oe);const e=async()=>{var p,m,l,I;console.log("fetching profile...");const n=await fetch(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/teachers/user/${t.userId}`);if(!n.ok)throw new Error("Failed to fetch user data");const x=await n.json();console.log(x);const f=((p=x.teacher)==null?void 0:p.classIds.map(v=>v._id))||[];return t.setAttributes((I=(l=(m=x.teacher)==null?void 0:m.userId)==null?void 0:l.teachingGroupId)==null?void 0:I.id,f),x.teacher},{data:s,isLoading:r,error:u}=Ze({queryKey:["teacherData"],queryFn:e,staleTime:1e3*60*5});let c=0;return console.log(c),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("div",{children:a.jsx(Xe,{user:s,isLoading:r})}),!s&&r&&a.jsx("div",{className:"flex justify-center mt-44",children:a.jsx(De,{size:32})}),s&&!r&&a.jsx(Fe,{children:a.jsxs("div",{className:"mt-20 flex-1 p-4",children:[a.jsxs("div",{className:"mb-4 space-y-1",children:[a.jsx("h1",{className:"text-xl font-medium",children:"Tenaga Pendidik"}),a.jsx(tt,{})]}),a.jsxs("div",{className:"mb-4",children:[s.classIds.map((n,x)=>{var p,m;if((m=(p=n==null?void 0:n.teachingGroupYearId)==null?void 0:p.academicYearId)==null?void 0:m.isActive)return c++,a.jsx(et,{data:n},x)}),c===0&&a.jsxs(Ue,{children:[a.jsx("p",{children:"Belum terdaftar di kelas manapun."}),a.jsxs("p",{children:["Buat kelas baru di ",a.jsx(Qe,{to:"/dashboard/academic",className:"active:text-blue-400 underline",children:"pengaturan akademik"})]})]})]})]})})]})};export{ht as default};
