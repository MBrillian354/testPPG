import{r as v,A as H,u as q,j as a,C as z}from"./index-BclD7Oek.js";import{C as A,A as K,p as P,a as R}from"./academicYearFormatter-DYavgDcV.js";import{S as V}from"./StudentReportView-DTBXnoGK.js";import{S as B}from"./StudentInitial-BUOKJrkB.js";import{a as C}from"./attendanceCount-EC2MUpAe.js";import{A as E}from"./index-B04DRbXT.js";import{m as N}from"./proxy-Y6K7WLgr.js";A.register(K,P,R);const w=(n,o=null,p=null)=>{const u=n.length,x=n.reduce((m,t)=>(m[t.status]=(m[t.status]||0)+1,m),{}),g=o?o*p:u,f=Object.entries(x).map(([m,t])=>({status:m,count:t,percentage:Math.round(t/g*100)})),c=["Hadir","Terlambat","Izin","Sakit","Tanpa Keterangan"];return f.sort((m,t)=>c.indexOf(m.status)-c.indexOf(t.status))},I=(n,o=null,p=null)=>{const u=w(n,o,p);return(()=>{const g=u.filter(t=>["Hadir","Terlambat"].includes(t.status)).reduce((t,h)=>({status:"Hadir",count:t.count+h.count,percentage:t.percentage+h.percentage}),{count:0,percentage:0}),f=u.filter(t=>["Izin","Sakit"].includes(t.status)).reduce((t,h)=>({status:"Tidak Hadir",count:t.count+h.count,percentage:t.percentage+h.percentage}),{count:0,percentage:0});let c=u.find(t=>t.status==="Tanpa Keterangan");return[g,f,c&&c.count>0?{status:"Tanpa Keterangan",count:c.count,percentage:c.percentage}:null].filter(Boolean).filter(t=>t.percentage>0)})()},O=n=>({Hadir:"bg-emerald-100 text-emerald-800",Terlambat:"bg-amber-100 text-amber-800",Izin:"bg-blue-100 text-blue-800",Sakit:"bg-purple-100 text-purple-800","Tanpa Keterangan":"bg-red-100 text-red-800","Tidak Hadir":"bg-orange-100 text-orange-800"})[n]||"bg-gray-100 text-gray-800",T=({status:n,percentage:o})=>a.jsxs("span",{className:`px-2 py-1 rounded-full text-center ${O(n)}`,children:[n," ",o,"%"]}),U=({data:n,violationData:o,initialView:p,month:u})=>{const[x,g]=v.useState(p),[f,c]=v.useState(null),[l,m]=v.useState(!1),[t,h]=v.useState(!1),S=v.useContext(H);q();const y={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},k={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},G=()=>{x==="students"?(g("classes"),c(null)):g("classes")},D=()=>{var j;const r=n.teachingGroupYears.find(e=>e.teachingGroupId._id===S.userTeachingGroupId);if(!r)return null;const d=r.classes.map(e=>({id:e._id,name:e.name,branchName:r.teachingGroupId.branchId.name,teachingGroupName:r.teachingGroupId.name,attendances:e.attendances,teachers:e.teachers,uniqueStudents:new Set(e.students.map(i=>i)).size,semesterTarget:r.semesterTarget}));return(j=n.teachingGroupYears.find(e=>e.teachingGroupId._id===S.userTeachingGroupId))==null||j.teachingGroupId.name,a.jsx(N.div,{variants:y,initial:"hidden",animate:"visible",className:"flex flex-col items-stretch",children:d.map(e=>a.jsxs(N.div,{variants:k,className:"card-basic rounded-md justify-between hover:cursor-pointer hover:bg-gray-50 hover:ring-1 transition-colors duration-200",onClick:()=>{c(e.id),g("students")},children:[a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("h3",{className:"text-lg font-medium",children:e.name}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Jumlah Siswa: ",e.uniqueStudents," siswa"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Total Pertemuan: ",C(e)," hari"]})]}),a.jsx("div",{className:"md:hidden flex flex-col md:flex-row gap-2 items-end md:items-end",children:I(e.attendances,l?e.semesterTarget:null,l?e.uniqueStudents:null).map((i,s)=>a.jsx(T,{...i},s))}),a.jsx("div",{className:"hidden md:flex flex-col md:flex-row items-end gap-2 md:items-center",children:w(e.attendances,l?e.semesterTarget:null,l?e.uniqueStudents:null).map((i,s)=>a.jsx(T,{...i},s))})]},e.id))})},_=()=>{const r=n.teachingGroupYears.find(e=>e.teachingGroupId._id===S.userTeachingGroupId),d=r==null?void 0:r.classes.find(e=>e._id===f);if(!d)return null;console.log(d);const j=d.attendances.reduce((e,i)=>{const s=i.studentId;return e.some(b=>b.id===s._id)||e.push({id:s._id,teachingGroupYearName:r.name,month:u,className:d.name,name:s.name,nis:s.nis,image:s.image,branchName:r.teachingGroupId.branchId.name,teachingGroupName:r.teachingGroupId.name,teachers:d.teachers,attendances:d.attendances.filter(b=>b.studentId._id===s._id),uniqueStudents:new Set(d.students.map(b=>b)).size,semesterTarget:r.semesterTarget}),e},[]);return a.jsxs(N.div,{variants:y,initial:"hidden",animate:"visible",className:"flex flex-col items-stretch",children:[a.jsxs("div",{className:"mx-4 md:mx-8  flex flex-col",children:[a.jsx("h2",{className:"text-xl font-bold",children:d.name}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Jumlah Siswa: ",j.uniqueStudents," siswa"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Total Pertemuan: ",C(d)," hari"]})]}),j.map(e=>a.jsxs(N.div,{onClick:()=>h(t===e.id?null:e.id),variants:k,children:[console.log(e),a.jsxs("div",{className:"card-basic rounded-md hover:cursor-pointer hover:bg-gray-50 hover:ring-1 hover:ring-primary flex-col transition-all duration-200",children:[a.jsxs("div",{className:"flex md:justify-between md:flex-row flex-col justify-start items-start gap-4 ",children:[a.jsxs("div",{className:"flex gap-3 items-center",children:[e.image?a.jsx("img",{src:e!=null&&e.image?`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/${e.image}`:"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541",alt:e.name,className:"size-14 rounded-full m-auto shrink-0"}):a.jsx(B,{studentName:e.name,clsName:"size-14 rounded-full bg-blue-200 text-blue-500 flex items-center justify-center font-medium m-auto shrink-0 grow-0"}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("h3",{className:"text-lg font-medium",children:e.name}),a.jsx("h4",{className:"",children:e.nis})]})]}),a.jsx("div",{className:"md:hidden flex flex-col md:flex-row gap-2 items-end md:items-end self-end",children:I(e.attendances,l?e.semesterTarget:null,l?e.uniqueStudents:null).map((i,s)=>a.jsx(T,{...i},s))}),a.jsx("div",{className:"hidden md:flex flex-col md:flex-row items-end gap-2 md:items-center",children:w(e.attendances,l?e.semesterTarget:null,l?e.uniqueStudents:null).map((i,s)=>a.jsx(T,{...i},s))})]}),S.userRole==="teacher"&&t===e.id&&a.jsx("div",{className:"mt-4",onClick:i=>i.stopPropagation(),children:a.jsx(N.div,{children:a.jsx(V,{studentData:e,attendanceData:w(e.attendances),violationData:o,noCard:!0})})})]})]},e.id))]})};return a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsxs("div",{className:"md:mx-8 mt-8 flex justify-between items-center",children:[a.jsxs("button",{onClick:G,className:"flex items-center text-primary hover:text-primary/80 transition-colors disabled:text-gray-400",disabled:x==="classes",children:[a.jsx(z,{className:"w-4 h-4 mr-1"}),"Kembali"]}),a.jsx("div",{className:"flex flex-col gap-2",children:a.jsxs("p",{children:["Kalkulasi Berdasarkan: ",l?a.jsx("strong",{children:"Hari efektif"}):a.jsx("strong",{children:"Hari berjalan"})]})})]}),a.jsxs(E,{mode:"wait",children:[x==="classes"&&D(),x==="students"&&_()]})]})};export{U as T};
