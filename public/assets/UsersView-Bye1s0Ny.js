import{r as i,a as P,u as T,A as _,j as e,E as L,M,L as y,c as N}from"./index-CP-NX24X.js";import{F as O}from"./FloatingMenu-xran9IDh.js";import{T as k}from"./trash-CNaClfa-.js";import{P as z}from"./plus-Bt27oCaq.js";import{U as F}from"./users-C1td52eI.js";import{C as H}from"./chevron-down-BSQZo0mi.js";import{P as V}from"./pencil-DdQ9hYEs.js";import"./createLucideIcon-BEmubaHH.js";const Z=()=>{const[x,u]=i.useState();i.useState("");const[r,o]=i.useState({title:"",message:"",onConfirm:null}),[C,c]=i.useState(!1),[d,p]=i.useState([]),[g,v]=i.useState({admin:!0,teachingGroupAdmin:!0,teacher:!0,student:!0}),w=["admin","teachingGroupAdmin","teacher","student"],{isLoading:h,error:f,sendRequest:m,setError:D}=P(),A=T(),b=i.useContext(_);i.useEffect(()=>{(async()=>{try{const t=await m("https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/users/");u(t),console.log(t)}catch{}})()},[m]);const E=s=>{v(t=>({...t,[s]:!t[s]}))},j=s=>({admin:"bg-red-100 text-red-700",teachingGroupAdmin:"bg-orange-100 text-orange-700",teacher:"bg-violet-100 text-violet-700",student:"bg-blue-100 text-blue-700"})[s]||"bg-gray-100 text-gray-700",S=s=>s==null?void 0:s.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),G=s=>{o({title:"Peringatan!",message:"Hapus Pengguna?",onConfirm:async()=>{try{const a=await m(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/users/${s}`,"DELETE",null,{Authorization:"Bearer "+b.token});o({title:"Berhasil!",message:a.message,onConfirm:null}),u(n=>({...n,users:n.users.filter(l=>l._id!==s)}))}catch{}}}),c(!0)},U=()=>{if(d.length===0){o({title:"Error",message:"Please select at least one user.",onConfirm:null}),c(!0);return}o({title:"Konfirmasi",message:"Hapus semua user yang dipilih?",onConfirm:async()=>{const t="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/users/bulk-delete",a=JSON.stringify({userIds:d});console.log(a);try{const n=await m(t,"DELETE",a,{"Content-Type":"application/json",Authorization:"Bearer "+b.token});o({title:"Berhasil!",message:n.message,onConfirm:null}),u(l=>({...l,users:l.users.filter(I=>!d.includes(I._id))})),p([])}catch{}}}),c(!0)},$=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{c(!1)},className:`${r.onConfirm?"btn-danger-outline":"button-primary mt-0 "}`,children:r.onConfirm?"Batal":"Tutup"}),r.onConfirm&&e.jsx("button",{onClick:r.onConfirm,className:"button-primary mt-0 ",children:"Ya"})]}),B=({user:s})=>{const t=d.includes(s._id),a=()=>{p(n=>t?n.filter(l=>l!==s._id):[...n,s._id])};return e.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:a,className:"mr-2"}),s.image?e.jsx("img",{src:`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/${s.image}`,alt:s.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:`w-10 h-10 rounded-full flex ${j(s.role)} items-center justify-center font-medium`,children:S(s.name)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`hidden md:inline-block px-2.5 py-0.5 rounded-full text-xs font-medium h-6 ${j(s.role)}`,children:s.role==="teachingGroupAdmin"?"Admin Kelompok":s.role==="teacher"?"Guru":s.role==="student"?"Siswa":"Admin Daerah"})]}),e.jsx("p",{className:"text-sm text-gray-500 hidden md:block",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-900 hidden md:block",children:s.teachingGroupId.branchId.name}),e.jsx("div",{className:"text-xs text-gray-500 hidden md:block",children:s.teachingGroupId.name})]}),e.jsx("div",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(O,{buttons:[{icon:V,label:"Edit",onClick:()=>A(`/settings/users/${s._id}`)},{icon:k,label:"Delete",variant:"danger",onClick:()=>G(s._id)}]})})]})]})};return e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[f&&e.jsx(L,{error:f,onClear:()=>D(null)}),e.jsxs(M,{isOpen:C,onClose:()=>c(!1),title:r.title,footer:e.jsx($,{}),children:[h&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(y,{size:32})}),!h&&r.message]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Daftar User"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,className:"button-danger disabled:hidden",disabled:d.length===0,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Hapus Akun"]}),e.jsx(N,{to:"/settings/users/new",children:e.jsxs("button",{className:"button-primary pl-[14px]",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Tambah Akun"]})}),e.jsx(N,{to:"/settings/users/bulk-create",children:e.jsxs("button",{className:"button-primary pl-[14px]",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Tambah Peserta Didik"]})})]})]}),h&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(y,{size:32})}),x&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white rounded-md shadow-sm",children:w.map(s=>{const t=x.users.filter(a=>a.role===s);return e.jsxs("div",{className:"divide-y",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 cursor-pointer flex items-center justify-between",onClick:()=>E(s),children:[e.jsx("span",{children:s==="teachingGroupAdmin"?"Admin Kelompok":s==="teacher"?"Guru":s==="student"?"Siswa":"Admin"}),e.jsx(H,{className:`w-4 h-4 transform transition-transform ${g[s]?"":"-rotate-90"}`})]}),g[s]&&t.map(a=>e.jsx(B,{user:a},a._id))]},s)})})})]})})};export{Z as default};
