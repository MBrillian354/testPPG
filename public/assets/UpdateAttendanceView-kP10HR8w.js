import{r,a as S,u as k,j as t,L as d}from"./index-CBFEDf3H.js";import{u as N}from"./http-hook-p1xhn-Qx.js";import{D as T}from"./DynamicForm-DnFPMFU5.js";import{E as I}from"./ErrorCard-DyotIidg.js";import{M as E}from"./ModalBottomClose-CrGWDDNY.js";import"./iconify-icon-C1YYA-Pd.js";const K=()=>{var c;const[i,b]=r.useState({title:"",message:"",onConfirm:null}),[f,o]=r.useState(!1),{isLoading:a,error:u,sendRequest:n,setError:y}=N(),[x,O]=r.useState(!1),[e,g]=r.useState(),h=S().attendanceId,v=k();r.useEffect(()=>{(async()=>{try{const s=await n(`https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/${h}`);g(s.attendance),console.log(s.attendance)}catch{}})()},[n]);const j=async l=>{console.log("Updating ... ");const s="https://ppg-academic-system-9b62c1c7b604.herokuapp.com/api/attendances/",m=JSON.stringify({updates:[{attendanceId:e.id,status:l.status,attributes:l.attributes,timestamp:Date.now()}]});console.log(m);let p;try{p=await n(s,"PATCH",m,{"Content-Type":"application/json"})}catch{}b({title:"Berhasil!",message:p.message,onConfirm:()=>v(-2)}),o(!0)},C=()=>t.jsx("div",{className:"flex gap-2 items-center",children:i.onConfirm&&t.jsx("button",{onClick:i.onConfirm,className:"button-primary mt-0 ",children:"Ok"})});return t.jsxs("div",{className:"m-auto max-w-md mt-14 md:mt-8",children:[t.jsxs(E,{isOpen:f,onClose:()=>o(!1),title:i.title,footer:t.jsx(C,{}),children:[a&&t.jsx("div",{className:"flex justify-center mt-16",children:t.jsx(d,{size:32})}),!a&&i.message]}),u&&t.jsx(I,{error:u,onClear:()=>y(null)}),t.jsx("div",{className:`pb-24 transition-opacity duration-300 ${x?"opacity-0":"opacity-100"}`,children:t.jsx(T,{subtitle:"Edit Data Absen",fields:[{name:"name",label:"Nama Lengkap",type:"text",required:!1,disabled:!0,value:((c=e==null?void 0:e.studentId)==null?void 0:c.name)||""},{name:"statusOld",label:"Status Kehadiran (sebelumnya)",type:"text",required:!1,disabled:!0,value:(e==null?void 0:e.status)||""},{name:"attributesOld",label:"Atribut (sebelumnya)",type:"text",required:!1,disabled:!0,value:e!=null&&e.attributes?"Ya":"Tidak"},{name:"status",label:"Status Kehadiran (baru)",type:"select",required:!0,value:(e==null?void 0:e.status)||"",options:[{label:"Hadir",value:"Hadir"},{label:"Terlambat",value:"Terlambat"},{label:"Izin",value:"Izin"},{label:"Sakit",value:"Sakit"},{label:"Tanpa Keterangan",value:"Tanpa Keterangan"}]},{name:"attributes",label:"Atribut Lengkap? (baru)",type:"select",required:!0,value:(e==null?void 0:e.attributes)||"",options:[{label:"Ya",value:"true"},{label:"Tidak",value:"false"}]}],onSubmit:j,disabled:a,reset:!1,footer:!1,button:t.jsx("div",{className:"flex flex-col justify-stretch mt-4",children:t.jsx("button",{type:"submit",className:`button-primary ${a?"opacity-50 cursor-not-allowed":""}`,disabled:a,children:a?t.jsx(d,{children:"Processing..."}):"Update"})})})})]})};export{K as default};
