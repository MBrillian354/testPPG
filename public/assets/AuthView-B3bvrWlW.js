import{r as p,A as N,u as v,j as s,L as I}from"./index-CUVeWTx6.js";import{u as C}from"./http-hook-BiPXVO_k.js";import{D as E}from"./DynamicForm-Biq1uxbt.js";import{E as G}from"./ErrorCard-IpMuaMVp.js";import{l as P}from"./ldii-7Wp3y75z.js";import"./iconify-icon-C1YYA-Pd.js";const q=()=>{const[u,$]=p.useState(!1),{isLoading:o,error:n,sendRequest:i,setError:g}=C(),h=p.useContext(N),x=v(),y=[{name:"email",label:"Email",placeholder:"Email",type:"email",required:!0},{name:"password",label:"Password",placeholder:"Password",type:"password",required:!0}],f=async c=>{var d,m;const b="http://192.168.1.13:5000/api/users/login",w=JSON.stringify({email:c.email,password:c.password});let e,l;try{e=await i(b,"POST",w,{"Content-Type":"application/json"});try{l=await i(`http://192.168.1.13:5000/api/teachingGroupYears/teachingGroup/${e.user.teachingGroupId.id}`)}catch{}let t;l&&(t=l.teachingGroupYears.find(a=>a.academicYearId.isActive));let r;if(e.user.role==="teacher")try{r=await i(`http://192.168.1.13:5000/api/teachers/user/${e.user.id}`),console.log(r)}catch(a){console.log(a)}console.log("logging IN"),console.log(e);const j=((d=r==null?void 0:r.teacher)==null?void 0:d.classIds.map(a=>a._id))||[];h.login(e.user.id,e.user.role,e.user.name,e.user.teachingGroupId.id,((m=t==null?void 0:t.academicYearId)==null?void 0:m.name)||null,j,e.token),console.log("logged IN")}catch(t){console.log(t)}};return s.jsx("div",{className:"m-auto max-w-md mt-16 md:mt-24",children:s.jsxs("div",{className:`pb-24 transition-opacity duration-300 ${u?"opacity-0":"opacity-100"}`,children:[n&&s.jsx("div",{className:"px-2",children:s.jsx(G,{error:n,onClear:()=>g(null)})}),s.jsx(E,{logo:P,title:"PPG Karawang",subtitle:"Sistem Absensi Digital",fields:y,onSubmit:f,disabled:o,labels:!1,button:s.jsx("div",{className:"flex flex-col justify-stretch mt-4",children:s.jsx("button",{type:"submit",className:`button-primary ${o?"opacity-50 cursor-not-allowed":""}`,disabled:o,children:o?s.jsx(I,{children:"Processing..."}):"Login"})}),helpButton:s.jsx("div",{onClick:()=>x("/reset-password/reset"),className:"text-center mt-2",children:s.jsx("p",{className:"underline text-xs text-gray-600 active:text-primary hover:text-primary hover:cursor-pointer",children:"Reset Password"})})})]})})};export{q as default};
